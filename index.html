<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Cyber Casino - Member Access</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@400;500&display=swap');
        body { font-family: 'Roboto', sans-serif; background-color: #020617; color: white; }
        .font-cyber { font-family: 'Orbitron', sans-serif; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .animate-float { animation: float 4s ease-in-out infinite; }
        .glass-panel { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .glow-btn:hover { box-shadow: 0 0 20px rgba(234, 179, 8, 0.5); }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Cropper Styles */
        .crop-wrapper { position: relative; width: 280px; height: 280px; margin: 0 auto; background: transparent; }
        .crop-overlay { position: absolute; inset: 0; border-radius: 50%; border: 4px solid #eab308; box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5); z-index: 20; pointer-events: none; }
        .drag-area { width: 100%; height: 100%; cursor: grab; overflow: hidden; position: relative; }
        .drag-area:active { cursor: grabbing; }
        .slider-thumb::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: #eab308; cursor: pointer; border-radius: 50%; }
        
        /* GAME STYLES */
        .wheel-container { transition: transform 5s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .slot-spinning .slot-symbol { animation: slot-spin 0.1s infinite linear; }
        @keyframes slot-spin { 0% { transform: translateY(0); } 100% { transform: translateY(-100%); } }

        /* Big Win Animation */
        @keyframes explode { 0% { transform: scale(0); opacity: 0; } 50% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes shake { 0%, 100% { transform: translate(0, 0); } 10%, 30%, 50%, 70%, 90% { transform: translate(-5px, -5px); } 20%, 40%, 60%, 80% { transform: translate(5px, 5px); } }
        @keyframes coin-fall { 0% { transform: translateY(-100vh) rotate(0deg); } 100% { transform: translateY(100vh) rotate(360deg); } }
        .big-win-overlay { animation: explode 0.5s ease-out forwards; }
        .shake-screen { animation: shake 0.5s ease-in-out; }
        .coin { position: absolute; width: 40px; height: 40px; background: url('https://cdn-icons-png.flaticon.com/512/217/217853.png') no-repeat center center/contain; animation: coin-fall 2s linear infinite; z-index: 100; }

        /* HighLow Card */
        .highlow-card { perspective: 1000px; }
        .highlow-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .highlow-card.flipped .highlow-card-inner { transform: rotateY(180deg); }
        .highlow-card-front, .highlow-card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 1rem; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .highlow-card-front { background: linear-gradient(135deg, #1e293b, #0f172a); border: 2px solid #334155; }
        .highlow-card-back { background: linear-gradient(135deg, #eab308, #ca8a04); transform: rotateY(180deg); color: black; font-weight: bold; font-size: 3rem; border: 2px solid #fef08a; }
        .highlow-card-back.win { background: linear-gradient(135deg, #22c55e, #15803d); border-color: #86efac; color: white; }
        .highlow-card-back.lose { background: linear-gradient(135deg, #ef4444, #b91c1c); border-color: #fca5a5; color: white; }

        /* Chat Animation */
        @keyframes slide-up { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .chat-bubble { animation: slide-up 0.3s ease-out; }

        /* === NEW BORDER & CROWN ANIMATIONS === */
        @keyframes spin-slow { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes spin-fast { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes border-pulse { 0% { border-color: #ff0000; box-shadow: 0 0 5px #ff0000; } 50% { border-color: #ffaa00; box-shadow: 0 0 20px #ffaa00; } 100% { border-color: #ff0000; box-shadow: 0 0 5px #ff0000; } }
        @keyframes rgb-flow { 0% { border-color: #ff0000; box-shadow: 0 0 10px #ff0000; } 33% { border-color: #00ff00; box-shadow: 0 0 10px #00ff00; } 66% { border-color: #0000ff; box-shadow: 0 0 10px #0000ff; } 100% { border-color: #ff0000; box-shadow: 0 0 10px #ff0000; } }
        @keyframes glitch-border { 0% { border-color: #0ff; transform: translate(0); } 20% { border-color: #f0f; transform: translate(-2px, 2px); } 40% { border-color: #0ff; transform: translate(-2px, -2px); } 60% { border-color: #f0f; transform: translate(2px, 2px); } 80% { border-color: #0ff; transform: translate(2px, -2px); } 100% { border-color: #0ff; transform: translate(0); } }
        @keyframes fire-glow { 0% { box-shadow: 0 0 5px #ff4500, inset 0 0 5px #ff4500; border-color: #ff4500; } 50% { box-shadow: 0 0 20px #ff8c00, inset 0 0 10px #ff8c00; border-color: #ff8c00; } 100% { box-shadow: 0 0 5px #ff4500, inset 0 0 5px #ff4500; border-color: #ff4500; } }
        @keyframes ice-glow { 0% { box-shadow: 0 0 5px #00ffff, inset 0 0 5px #00ffff; border-color: #00ffff; } 50% { box-shadow: 0 0 20px #e0ffff, inset 0 0 10px #e0ffff; border-color: #e0ffff; } 100% { box-shadow: 0 0 5px #00ffff, inset 0 0 5px #00ffff; border-color: #00ffff; } }
        @keyframes matrix-pulse { 0% { border-color: #0f0; box-shadow: 0 0 5px #0f0; } 100% { border-color: #003300; box-shadow: 0 0 2px #0f0; } }
        @keyframes gold-shimmer { 0% { border-color: #ffd700; box-shadow: 0 0 5px #ffd700; } 50% { border-color: #ffec8b; box-shadow: 0 0 25px #ffd700; } 100% { border-color: #ffd700; box-shadow: 0 0 5px #ffd700; } }
        @keyframes crown-float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-5px) rotate(2deg); } }
        @keyframes crown-shine { 0% { filter: drop-shadow(0 0 2px gold); } 50% { filter: drop-shadow(0 0 15px yellow); } 100% { filter: drop-shadow(0 0 2px gold); } }
        @keyframes crown-fire { 0% { filter: drop-shadow(0 0 2px red); } 50% { filter: drop-shadow(0 0 15px orange); } 100% { filter: drop-shadow(0 0 2px red); } }
        @keyframes crown-ice { 0% { filter: drop-shadow(0 0 2px cyan); } 50% { filter: drop-shadow(0 0 15px blue); } 100% { filter: drop-shadow(0 0 2px cyan); } }
        @keyframes crown-rainbow { 0% { filter: drop-shadow(0 0 2px violet); } 50% { filter: drop-shadow(0 0 15px cyan); } 100% { filter: drop-shadow(0 0 2px violet); } }
        @keyframes crown-glitch { 0% { transform: translate(0); } 20% { transform: translate(-2px, 2px); } 40% { transform: translate(-2px, -2px); } 60% { transform: translate(2px, 2px); } 80% { transform: translate(2px, -2px); } 100% { transform: translate(0); } }

        /* Border Classes */
        .border-neon-blue { border: 3px solid #3b82f6; box-shadow: 0 0 10px #3b82f6, inset 0 0 5px #3b82f6; }
        .border-neon-pink { border: 3px solid #ec4899; box-shadow: 0 0 10px #ec4899, inset 0 0 5px #ec4899; }
        .border-gold-king { border: 4px solid #fbbf24; box-shadow: 0 0 15px #fbbf24; background: linear-gradient(45deg, #92400e, #fbbf24); }
        .border-rainbow { border: 3px solid transparent; background: linear-gradient(#0f172a, #0f172a) padding-box, linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet) border-box; }
        
        /* Animated Borders */
        .border-rgb-flow { border: 3px solid transparent; animation: rgb-flow 3s infinite linear; }
        .border-fire { border: 3px solid #ff4500; animation: fire-glow 2s infinite; }
        .border-ice { border: 3px solid #00ffff; animation: ice-glow 2s infinite; }
        .border-glitch { border: 2px solid #0ff; animation: glitch-border 0.3s infinite; }
        .border-matrix { border: 2px solid #0f0; animation: matrix-pulse 1s infinite alternate; font-family: monospace; }
        .border-gold-shimmer { border: 4px solid #ffd700; animation: gold-shimmer 3s infinite; }
        .border-plasma { border: 3px solid #a855f7; box-shadow: 0 0 10px #a855f7, 0 0 20px #ec4899; }
        .border-double-ring { border: 4px double #ffffff; box-shadow: 0 0 10px #ffffff; }
        .border-dashed-anim { border: 3px dashed #fbbf24; animation: spin-slow 10s infinite linear; }
        .border-collector { border: 4px solid transparent; background: linear-gradient(#000, #000) padding-box, conic-gradient(from 0deg, #ff0000, #ff8800, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000) border-box; animation: spin-slow 4s infinite linear; box-shadow: 0 0 20px rgba(255,255,255,0.5); }
        
        /* Solid Colors */
        .border-solid-red { border: 3px solid #ef4444; }
        .border-solid-green { border: 3px solid #22c55e; }
        .border-solid-blue { border: 3px solid #3b82f6; }
        .border-solid-yellow { border: 3px solid #eab308; }
        .border-solid-purple { border: 3px solid #a855f7; }
        .border-solid-orange { border: 3px solid #f97316; }
        .border-solid-cyan { border: 3px solid #06b6d4; }
        .border-solid-pink { border: 3px solid #ec4899; }
        .border-solid-white { border: 3px solid #ffffff; }
        .border-solid-gray { border: 3px solid #64748b; }

        /* Crown Effects */
        .crown-wrapper { position: absolute; top: -24px; left: 50%; transform: translateX(-50%); z-index: 20; pointer-events: none; }
        .crown-anim-default { animation: crown-float 3s ease-in-out infinite; color: #fbbf24; filter: drop-shadow(0 0 2px #000); }
        .crown-anim-shine { animation: crown-shine 2s infinite; color: #ffd700; }
        .crown-anim-fire { animation: crown-fire 1.5s infinite; color: #ef4444; }
        .crown-anim-ice { animation: crown-ice 3s infinite; color: #06b6d4; }
        .crown-anim-rainbow { animation: crown-rainbow 5s linear infinite; color: #d946ef; filter: hue-rotate(90deg); }
        .crown-anim-glitch { animation: crown-glitch 0.2s infinite; color: #22c55e; }

        /* Minigame Styles */
        .bird-target { animation: float-bird 3s linear infinite; cursor: crosshair; }
        @keyframes float-bird { 0% { transform: translateY(0) translateX(0); } 25% { transform: translateY(-20px) translateX(10px); } 50% { transform: translateY(0) translateX(0); } 75% { transform: translateY(20px) translateX(-10px); } 100% { transform: translateY(0) translateX(0); } }
        .hacker-mole { transition: top 0.1s; }
        
        /* Race Track */
        .race-track { background: repeating-linear-gradient(90deg, #334155 0px, #334155 50px, #1e293b 50px, #1e293b 100px); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const SUPABASE_URL = 'https://burwdynmnxxefhoeyudv.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ1cndkeW5tbnh4ZWZob2V5dWR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3MzE2ODgsImV4cCI6MjA3OTMwNzY4OH0.zeL1Lp5nbyb5CXbhYQ_VtyR12-59CetzwngcrTclVY0';

        const localStore = {
            get: (key) => JSON.parse(localStorage.getItem(key) || 'null'),
            set: (key, val) => localStorage.setItem(key, JSON.stringify(val))
        };

        // --- FIX: MOCK CLIENT YANG LEBIH KUAT & SUPPORT CHAINING ---
        class MockSupabaseClient {
            constructor() { console.warn("Mode Offline Aktif"); }
            get auth() { 
                return { 
                    signUp: async ({ email, options }) => ({ data: { user: { id: 'local_'+email, email, user_metadata: options?.data } }, error: null }), 
                    signInWithPassword: async ({ email }) => ({ data: { user: { id: 'local_'+email, email } }, error: null }), 
                    signOut: async () => ({ error: null }), 
                    getSession: async () => ({ data: { session: null } }), 
                    onAuthStateChange: (cb) => ({ data: { subscription: { unsubscribe: () => {} } } }), 
                    updateUser: async (data) => ({ data: { user: { ...data } }, error: null }) 
                }; 
            }
            from(table) {
                const builder = {
                    select: () => builder,
                    eq: () => builder,
                    order: () => builder,
                    limit: () => builder,
                    ilike: () => builder,
                    range: () => builder,
                    single: async () => ({ data: null, error: 'Offline Mode: Data unavailable' }),
                    then: (resolve) => resolve({ data: [], error: null }), 
                    insert: async () => ({ error: null }),
                    update: async () => ({ error: 'Offline', eq: () => ({}) }),
                    delete: async () => ({ error: null, eq: () => ({}), neq: () => ({}) })
                };
                return builder;
            }
            channel() { return { on: () => ({ subscribe: () => {} }), unsubscribe: () => {} }; }
        }

        let supabase;
        try { supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY, { auth: { persistSession: true, autoRefreshToken: true } }); } catch (e) { supabase = new MockSupabaseClient(); }

        const Icons = {
            Crown: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m2 4 3 12h14l3-12-6 7-4-3-4 3-6-7zm5 16h10"/></svg>,
            User: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            Lock: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            LogOut: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>,
            Refresh: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>,
            Home: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            CreditCard: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>,
            Info: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>,
            Zap: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Settings: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Message: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            Image: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>,
            Edit: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Check: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            Play: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Disc: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>,
            TrendingUp: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
            ArrowDown: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 20L4 10h16l-8 10z"/></svg>,
            Megaphone: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 11 18-5v12L3 14v-3z"/><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"/></svg>,
            MapPin: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>,
            ArrowLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
            Inbox: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-6l-2 3h-4l-2-3H2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-9Z"/><path d="M22 12v-9a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v9"/></svg>,
            FileText: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>,
            Minus: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Send: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>,
            Chat: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            Minimize: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 3v3a2 2 0 0 1-2 2H3"/><path d="M21 8h-3a2 2 0 0 1-2-2V3"/><path d="M3 16h3a2 2 0 0 1 2 2v3"/><path d="M16 21v-3a2 2 0 0 1 2-2h3"/></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            ShoppingBag: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>,
            Maximize: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg>,
            Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            Dices: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="12" height="12" x="2" y="10" rx="2" ry="2"/><path d="m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6"/><path d="M6 18h.01"/><path d="M10 14h.01"/><path d="M15 6h.01"/><path d="M18 9h.01"/></svg>,
            Rocket: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></svg>,
            Target: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
            Skull: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></svg>,
            Pickaxe: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M12 13l-3 3"/><path d="M9 16l-2 2"/><path d="M15 10l2-2"/></svg>,
            Horse: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 4c-5 0-7 4-7 4l-2.5-1.5 2.5 5.5-4 2.5-5-2-2 3 1.5 1.5 10 3 6-4 2-4 2-4-2-4z"/><path d="M16 14v7"/><path d="M12 14v4"/><path d="M8 13v4"/></svg>,
            Football: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 12l4-2.5"/><path d="M12 12l-4-2.5"/><path d="M12 12v4.5"/><path d="M16 9.5l2.5-2.5"/><path d="M8 9.5l-2.5-2.5"/><path d="M12 16.5l3 3"/><path d="M12 16.5l-3 3"/></svg>
        };

        // --- BORDER CATALOG ---
        const BORDER_CATALOG = [
            { id: 'default', name: 'Default', price: 0, class: 'border-2 border-yellow-500' },
            { id: 'solid-red', name: 'Red Basic', price: 1000, class: 'border-solid-red' },
            { id: 'solid-green', name: 'Green Basic', price: 1000, class: 'border-solid-green' },
            { id: 'solid-blue', name: 'Blue Basic', price: 1000, class: 'border-solid-blue' },
            { id: 'solid-purple', name: 'Purple Basic', price: 1000, class: 'border-solid-purple' },
            { id: 'solid-cyan', name: 'Cyan Basic', price: 1000, class: 'border-solid-cyan' },
            { id: 'solid-orange', name: 'Orange Basic', price: 1000, class: 'border-solid-orange' },
            { id: 'solid-pink', name: 'Pink Basic', price: 1000, class: 'border-solid-pink' },
            { id: 'solid-white', name: 'Clean White', price: 2000, class: 'border-solid-white' },
            { id: 'solid-gray', name: 'Steel Gray', price: 2000, class: 'border-solid-gray' },
            { id: 'neon-blue', name: 'Neon Blue', price: 10000, class: 'border-neon-blue' },
            { id: 'neon-pink', name: 'Neon Pink', price: 10000, class: 'border-neon-pink' },
            { id: 'neon-green', name: 'Neon Green', price: 10000, class: 'border-2 border-green-400 shadow-[0_0_10px_#4ade80]' },
            { id: 'neon-red', name: 'Neon Red', price: 10000, class: 'border-2 border-red-500 shadow-[0_0_10px_#ef4444]' },
            { id: 'neon-purple', name: 'Neon Purple', price: 12000, class: 'border-2 border-purple-500 shadow-[0_0_10px_#a855f7]' },
            { id: 'grad-sunset', name: 'Sunset', price: 25000, class: 'p-1 bg-gradient-to-br from-orange-500 to-purple-600' },
            { id: 'grad-ocean', name: 'Ocean Depth', price: 25000, class: 'p-1 bg-gradient-to-br from-blue-400 to-blue-900' },
            { id: 'grad-forest', name: 'Mystic Forest', price: 25000, class: 'p-1 bg-gradient-to-br from-green-400 to-emerald-900' },
            { id: 'grad-love', name: 'Love Potion', price: 25000, class: 'p-1 bg-gradient-to-br from-pink-400 to-red-600' },
            { id: 'grad-gold', name: 'Liquid Gold', price: 30000, class: 'p-1 bg-gradient-to-b from-yellow-300 via-yellow-500 to-yellow-700' },
            { id: 'grad-silver', name: 'Silver Lining', price: 30000, class: 'p-1 bg-gradient-to-b from-slate-300 via-slate-100 to-slate-400' },
            { id: 'anim-pulse-red', name: 'Red Pulse', price: 50000, class: 'border-2 border-red-500 animate-pulse' },
            { id: 'anim-pulse-gold', name: 'Gold Pulse', price: 55000, class: 'border-2 border-yellow-400 animate-pulse' },
            { id: 'anim-spin-dash', name: 'Dashed Spin', price: 60000, class: 'border-dashed-anim' },
            { id: 'anim-double', name: 'Double Ring', price: 65000, class: 'border-double-ring' },
            { id: 'glow-fire', name: 'Fire Aura', price: 75000, class: 'border-fire' },
            { id: 'glow-ice', name: 'Ice Aura', price: 75000, class: 'border-ice' },
            { id: 'rgb-flow', name: 'RGB Gamer', price: 80000, class: 'border-rgb-flow' },
            { id: 'glitch', name: 'Cyber Glitch', price: 90000, class: 'border-glitch' },
            { id: 'matrix', name: 'The Matrix', price: 95000, class: 'border-matrix' },
            { id: 'gold-king', name: 'Gold King', price: 100000, class: 'border-gold-king' },
            { id: 'gold-shimmer', name: 'Royal Shimmer', price: 120000, class: 'border-gold-shimmer' },
            { id: 'plasma', name: 'Plasma Coil', price: 150000, class: 'border-plasma' },
            { id: 'rainbow', name: 'Rainbow', price: 500000, class: 'border-rainbow' },
            { id: 'collector', name: 'The Collector', price: 999999, class: 'border-collector' },
        ];
        
        // --- CROWN CATALOG ---
        const CROWN_CATALOG = Array.from({ length: 30 }, (_, i) => {
            const id = i + 1;
            let styleClass = "crown-anim-default";
            let name = `Crown MK-${id}`;
            let price = 1000000 + (i * 100000);
            
            if (id > 5) styleClass = "crown-anim-shine";
            if (id > 10) styleClass = "crown-anim-fire";
            if (id > 15) styleClass = "crown-anim-ice";
            if (id > 20) styleClass = "crown-anim-rainbow";
            if (id > 25) styleClass = "crown-anim-glitch";
            
            return { id: `crown-${id}`, name: name, price: price, class: styleClass };
        });

        const getBorderClass = (id) => {
            const item = BORDER_CATALOG.find(b => b.id === id);
            return item ? item.class : 'border-2 border-yellow-500';
        };
        
        const getCrownClass = (id) => {
            const item = CROWN_CATALOG.find(c => c.id === id);
            return item ? item.class : 'hidden';
        }

        const GAME_INFO = {
            slot: { title: "Cara Main: Cyber Slots", desc: "Putar gulungan. Cocokkan simbol di baris tengah. 'Z' (Petir) bayaran tertinggi!", win: "3-5 simbol sama.", luck: "Meningkatkan peluang Wild." },
            wheel: { title: "Cara Main: Neon Wheel", desc: "Pertaruhkan chip dan putar roda. Hindari ZONK, cari pengali x10!", win: "Berhenti di Multiplier.", luck: "Ilusi ZONK lebih kecil." },
            highlow: { title: "Cara Main: Code Breaker", desc: "Tebak angka berikutnya LEBIH BESAR atau KECIL dari sekarang (1-13).", win: "Tebakan benar x2.", luck: "Hint probabilitas." },
            dice: { title: "Cara Main: Cosmic Dice", desc: "Prediksi total 2 dadu: Rendah (2-6), Tujuh (7), Tinggi (8-12).", win: "Tebakan benar. 7 bayar x5.", luck: "Dadu favorit." },
            rocket: { title: "Cara Main: Rocket Crash", desc: "Roket terbang, pengali naik. Tekan AMBIL sebelum meledak!", win: "Cashout sebelum Crash.", luck: "Roket terbang lebih lama." },
            horse: { title: "Cara Main: Derby Raja", desc: "Balapan kuda virtual! Pilih satu dari 5 kuda jagoan. Jika kudamu finish pertama, kamu menang besar.", win: "Juara 1 (x10).", luck: "Boost kecepatan acak." },
            soccer: { title: "Cara Main: Liga Juara", desc: "Simulasi turnamen sepak bola Eropa. Pilih tim favoritmu dari 16 besar. Jika timmu juara turnamen, jackpot menanti!", win: "Juara Turnamen (x20).", luck: "Tim lebih jago penalti." }
        };
        
        const EVENT_DESCRIPTIONS = {
            hunt: {
                title: "CYBER HUNT: Misi Penembak Jitu",
                story: "Halo Gamers! Siap jadi penembak jitu? Di game Cyber Hunt ini, tugas kamu gampang banget tapi butuh ketelitian super. Kamu bakal melihat drone-drone nakal atau burung cyber yang beterbangan liar di layar kamu. Jangan biarkan mereka lolos!",
                how: "Tugas kamu adalah menembak mereka alias 'tap' targetnya sebanyak-banyaknya! Setiap kali kamu berhasil menembak satu target, kamu bakal dapet 50 Credit tunai langsung! Ingat, waktunya cuma 30 detik, jadi jangan sampai meleng ya. Arahkan jarimu, fokus, dan DOR! Kumpulkan uang sebanyak-banyaknya buat modal main slot nanti. Semangat!",
            },
            hacker: {
                title: "FIREWALL DEFENDER: Gepuk Hacker",
                story: "Waduh gawat! Sistem keamanan kita lagi diserang sama hacker-hacker iseng nih! Mereka mencoba masuk lewat celah-celah firewall. Kamu adalah benteng terakhir kami. Kamu harus bantuin kita buat gepuk mereka balik ke asalnya.",
                how: "Game ini simpel banget, mirip main pukul tikus tanah di timezone. Nanti bakal muncul kepala-kepala hacker dari lubang persembunyiannya secara acak. Tugas kamu cuma satu: PUKUL MEREKA! Cepat-cepat tekan kepalanya sebelum mereka sembunyi lagi. Setiap pukulan yang kena, kamu dapet 30 Credit. Lumayan banget kan buat nambah-nambah saldo? Yuk, amankan sistem kita dan jadi kaya raya!",
            },
            miner: {
                title: "DATA MINER: Klik Cepat Cuan Kilat",
                story: "Lagi butuh uang gampang tanpa mikir keras? Nah, Data Miner ini jawabannya! Di sini kamu gak perlu strategi, cuma perlu jari yang super cepat dan kuat. Anggap aja kamu lagi nambang data berharga di tambang digital.",
                how: "Caranya gampang banget! KLIK atau TAP tombol petir besar di tengah layar secepat kilat! Semakin cepat kamu nge-klik, semakin banyak data yang kamu tambang, dan tentunya semakin banyak Credit yang mengalir ke kantongmu. Setiap klik bernilai 5 Credit. Kalau jarimu sakti, kamu bisa panen ribuan credit dalam 30 Detik! Siapkan jarimu, tarik napas, dan mulai mining sekarang!",
            }
        };

        // --- UTILS ---
        function BetControl({ bet, setBet, balance }) {
            const minBet = 100;
            
            const handleInputChange = (e) => {
                const val = e.target.value.replace(/[^0-9]/g, '');
                let numVal = val === '' ? 0 : parseInt(val);
                if (numVal > balance) numVal = balance; // Validasi: Tidak boleh lebih dari saldo
                setBet(numVal);
            };

            const handleBlur = () => {
                let newBet = bet;
                if (newBet < minBet) newBet = minBet;
                if (newBet > balance) newBet = balance;
                setBet(newBet);
            }

            const adjustBet = (amount) => {
                let newBet = bet + amount;
                if (newBet < minBet) newBet = minBet;
                if (newBet > balance) newBet = balance;
                setBet(newBet);
            };

            return (
                <div className="flex items-center justify-between bg-black/40 p-2 rounded-xl border border-white/10 w-full mb-4 gap-2">
                    <button onClick={() => adjustBet(-100)} className="p-3 bg-slate-800 hover:bg-slate-700 rounded-lg text-red-400 flex-shrink-0"><Icons.Minus /></button>
                    <div className="flex-1 relative">
                        <div className="absolute -top-3 left-1/2 -translate-x-1/2 text-[10px] text-slate-400 uppercase bg-slate-900 px-1">TARUHAN (MAX: {balance.toLocaleString()})</div>
                        <input type="text" value={bet} onChange={handleInputChange} onBlur={handleBlur} className="w-full bg-transparent text-center text-xl font-bold text-yellow-400 font-mono outline-none border-none py-1" />
                    </div>
                    <button onClick={() => adjustBet(100)} className="p-3 bg-slate-800 hover:bg-slate-700 rounded-lg text-green-400 flex-shrink-0"><Icons.Plus /></button>
                </div>
            );
        }

        // --- COMPONENTS ---
        function GameAds() {
            const ads = ["https://picsum.photos/seed/ad1/400/150","https://picsum.photos/seed/ad2/400/150","https://picsum.photos/seed/ad3/400/150"];
            const [currentAd, setCurrentAd] = React.useState(0);
            React.useEffect(() => { const timer = setInterval(() => { setCurrentAd((prev) => (prev + 1) % ads.length); }, 5000); return () => clearInterval(timer); }, []);
            return (<div className="mt-6 w-full max-w-lg mx-auto overflow-hidden rounded-xl shadow-lg border border-white/10 relative h-24 sm:h-32 bg-slate-800">{ads.map((ad, index) => (<img key={index} src={ad} alt={`Iklan ${index + 1}`} className={`absolute inset-0 w-full h-full object-cover transition-opacity duration-1000 ${index === currentAd ? 'opacity-100' : 'opacity-0'}`} />))}<div className="absolute top-1 right-1 bg-black/60 text-white text-[8px] px-1 rounded">IKLAN</div></div>);
        }

        function ImageCropper({ imageSrc, onCancel, onCrop }) {
            const [zoom, setZoom] = React.useState(1);
            const [minZoom, setMinZoom] = React.useState(0.1);
            const [position, setPosition] = React.useState({ x: 0, y: 0 });
            const [dragging, setDragging] = React.useState(false);
            const [lastPos, setLastPos] = React.useState({ x: 0, y: 0 });
            const imgRef = React.useRef(null);
            const CONTAINER_SIZE = 280; 
            React.useEffect(() => {
                const img = new Image();
                img.src = imageSrc;
                img.onload = () => {
                    const widthRatio = CONTAINER_SIZE / img.naturalWidth;
                    const heightRatio = CONTAINER_SIZE / img.naturalHeight;
                    const fitZoom = Math.max(widthRatio, heightRatio);
                    setZoom(fitZoom);
                    setMinZoom(fitZoom * 0.5); 
                };
            }, [imageSrc]);
            const handleMouseDown = (e) => { setDragging(true); setLastPos({ x: e.clientX, y: e.clientY }); };
            const handleMouseMove = (e) => { if (!dragging) return; const dx = e.clientX - lastPos.x; const dy = e.clientY - lastPos.y; setPosition(prev => ({ x: prev.x + dx, y: prev.y + dy })); setLastPos({ x: e.clientX, y: e.clientY }); };
            const handleMouseUp = () => setDragging(false);
            const handleSave = () => {
                const canvas = document.createElement('canvas');
                const size = 300; canvas.width = size; canvas.height = size;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#000'; ctx.fillRect(0, 0, size, size);
                if(imgRef.current) {
                    const scaleFactor = size / CONTAINER_SIZE;
                    const imgWidth = imgRef.current.naturalWidth * zoom * scaleFactor;
                    const imgHeight = imgRef.current.naturalHeight * zoom * scaleFactor;
                    const drawX = (size - imgWidth) / 2 + (position.x * scaleFactor);
                    const drawY = (size - imgHeight) / 2 + (position.y * scaleFactor);
                    ctx.save(); ctx.beginPath(); ctx.arc(size/2, size/2, size/2, 0, Math.PI * 2); ctx.clip();
                    ctx.drawImage(imgRef.current, drawX, drawY, imgWidth, imgHeight); ctx.restore();
                }
                onCrop(canvas.toDataURL('image/jpeg', 0.7));
            };
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm p-4 animate-fade-in" onMouseMove={handleMouseMove} onMouseUp={handleMouseUp} onMouseLeave={handleMouseUp} onTouchMove={handleMouseMove} onTouchEnd={handleMouseUp}>
                    <div className="bg-slate-800 p-6 rounded-2xl w-full max-w-sm border border-white/10 shadow-2xl">
                        <h3 className="text-xl font-bold text-white mb-4 text-center">Sesuaikan Foto</h3>
                        <div className="flex justify-center mb-6 select-none"><div className="crop-wrapper"><div className="crop-overlay"></div><div className="drag-area" onMouseDown={handleMouseDown} onTouchStart={(e)=>{setDragging(true); setLastPos({x:e.touches[0].clientX, y:e.touches[0].clientY})}}><img ref={imgRef} src={imageSrc} className="absolute max-w-none pointer-events-none transition-transform duration-75" style={{ transform: `translate(calc(-50% + ${position.x}px), calc(-50% + ${position.y}px)) scale(${zoom})`, left: '50%', top: '50%' }}/></div></div></div>
                        <div className="mb-6 px-4"><input type="range" min={minZoom} max={minZoom * 5} step={minZoom / 20} value={zoom} onChange={(e) => setZoom(parseFloat(e.target.value))} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider-thumb"/></div>
                        <div className="flex gap-3"><button onClick={onCancel} className="flex-1 py-3 rounded-xl bg-slate-700 text-white font-bold flex justify-center gap-2 hover:bg-slate-600"><Icons.X/> Batal</button><button onClick={handleSave} className="flex-1 py-3 rounded-xl bg-yellow-500 text-black font-bold flex justify-center gap-2 hover:bg-yellow-400"><Icons.Check/> Simpan</button></div>
                    </div>
                </div>
            );
        }

        function AuthPage() {
            const [isRegister, setIsRegister] = React.useState(false);
            const [email, setEmail] = React.useState('');
            const [fullName, setFullName] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [loading, setLoading] = React.useState(false);
            const [errorMsg, setErrorMsg] = React.useState('');
            const [successMsg, setSuccessMsg] = React.useState('');
            const handleAuth = async (e) => {
                e.preventDefault(); setLoading(true); setErrorMsg(''); setSuccessMsg('');
                const cleanEmail = email.trim();
                try {
                    if (isRegister) {
                        if (!fullName) throw new Error("Nama Lengkap wajib diisi!");
                        const { error } = await supabase.auth.signUp({ email: cleanEmail, password, options: { data: { full_name: fullName } } });
                        if (error) throw error;
                        setSuccessMsg("Daftar Berhasil! Silakan Login.");
                    } else {
                        const { error } = await supabase.auth.signInWithPassword({ email: cleanEmail, password });
                        if (error) throw error;
                    }
                } catch (error) {
                    let msg = error.message;
                    if (msg.includes("fetch")) { localStorage.setItem('sb-session', JSON.stringify({ user: { id: 'local_'+cleanEmail, email: cleanEmail, user_metadata: { full_name: fullName || 'Guest' } } })); window.location.reload(); return; }
                    if (msg.includes("Invalid login")) msg = "Email/Password salah.";
                    setErrorMsg(msg);
                } finally { setLoading(false); }
            };
            return (
                <div className="min-h-screen flex items-center justify-center p-4 bg-[#020617] relative">
                    <div className="absolute inset-0 pointer-events-none"><div className="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-purple-900/20 to-blue-900/20"></div></div>
                    <div className="w-full max-w-md glass-panel p-8 rounded-2xl shadow-2xl relative z-10">
                        <div className="text-center mb-6"><h1 className="text-3xl font-bold text-yellow-500 font-cyber tracking-widest">ROYAL CYBER</h1></div>
                        <div className="flex border-b border-white/10 mb-6"><button onClick={() => setIsRegister(false)} className={`flex-1 py-3 text-sm font-bold ${!isRegister ? 'text-yellow-400 border-b-2 border-yellow-400' : 'text-slate-500'}`}>MASUK</button><button onClick={() => setIsRegister(true)} className={`flex-1 py-3 text-sm font-bold ${isRegister ? 'text-yellow-400 border-b-2 border-yellow-400' : 'text-slate-500'}`}>DAFTAR</button></div>
                        <form onSubmit={handleAuth} className="space-y-4">{errorMsg && <div className="bg-red-500/20 text-red-200 px-4 py-2 rounded text-sm">{errorMsg}</div>}{successMsg && <div className="bg-green-500/20 text-green-200 px-4 py-2 rounded text-sm">{successMsg}</div>}{isRegister && (<div className="relative group animate-fade-in"><div className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"><Icons.User /></div><input type="text" required className="w-full bg-slate-800/50 border border-white/10 rounded-xl py-3 pl-10 text-white focus:border-yellow-500 outline-none" placeholder="Nama Lengkap" value={fullName} onChange={(e)=>setFullName(e.target.value)}/></div>)}<div className="relative group"><div className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg></div><input type="email" required className="w-full bg-slate-800/50 border border-white/10 rounded-xl py-3 pl-10 text-white focus:border-yellow-500 outline-none" placeholder="Email" value={email} onChange={(e)=>setEmail(e.target.value)}/></div><div className="relative group"><div className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"><Icons.Lock /></div><input type="password" required className="w-full bg-slate-800/50 border border-white/10 rounded-xl py-3 pl-10 text-white focus:border-yellow-500 outline-none" placeholder="Password" value={password} onChange={(e)=>setPassword(e.target.value)}/></div><button type="submit" disabled={loading} className="w-full py-4 bg-gradient-to-r from-yellow-600 to-yellow-400 text-black font-bold rounded-xl font-cyber glow-btn mt-4">{loading ? 'LOADING...' : (isRegister ? 'DAFTAR' : 'MASUK')}</button></form>
                    </div>
                </div>
            );
        }

        function GameSlots({ balance, updateBalance, setWinMessage }) {
            const SYMBOLS = [{id:'Z', icon:'âš¡', val:100, color:'text-yellow-400'},{id:'7', icon:'7ï¸âƒ£', val:50, color:'text-red-500'},{id:'D', icon:'ðŸ’Ž', val:20, color:'text-cyan-400'},{id:'K', icon:'ðŸ‘‘', val:10, color:'text-purple-400'},{id:'C', icon:'ðŸ’', val:5, color:'text-pink-500'}];
            const [grid, setGrid] = React.useState(() => Array.from({ length: 5 }, () => [SYMBOLS[0], SYMBOLS[0], SYMBOLS[0]]));
            const [isSpinning, setIsSpinning] = React.useState(false);
            const [winAmount, setWinAmount] = React.useState(0);
            const [isAuto, setIsAuto] = React.useState(false);
            const [showBigWin, setShowBigWin] = React.useState(false);
            const [bet, setBet] = React.useState(200);
            const autoRef = React.useRef(isAuto);
            React.useEffect(() => { autoRef.current = isAuto; }, [isAuto]);
            const getRandomSymbol = () => SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
            const getRandomReel = () => [getRandomSymbol(), getRandomSymbol(), getRandomSymbol()];
            const spin = async () => {
                if (balance < bet) { setIsAuto(false); return setWinMessage("Saldo Kurang!"); }
                setShowBigWin(false); 
                const currentBalance = balance - bet;
                updateBalance(currentBalance);
                setIsSpinning(true); setWinAmount(0); setWinMessage("Spinning...");
                const interval = setInterval(() => { setGrid(Array.from({ length: 5 }, () => getRandomReel())); }, 100);
                await new Promise(r => setTimeout(r, 2000));
                clearInterval(interval);
                const finalGrid = Array.from({ length: 5 }, () => getRandomReel());
                setGrid(finalGrid);
                const midRow = finalGrid.map(col => col[1]);
                let winMultiplier = 0;
                if (midRow.every(s => s.id === midRow[0].id)) winMultiplier = midRow[0].val * 100;
                else if (midRow.slice(0,4).every(s => s.id === midRow[0].id)) winMultiplier = midRow[0].val * 20;
                else if (midRow.slice(0,3).every(s => s.id === midRow[0].id)) winMultiplier = midRow[0].val * 5;
                const winTotal = winMultiplier * (bet / 100); 
                if (winTotal >= bet * 20) { setShowBigWin(true); setWinMessage("SENSATIONAL!!!"); if(navigator.vibrate) navigator.vibrate(500); } else if (winTotal > 0) { setWinMessage(`Win +${winTotal.toLocaleString()}`); } else { setWinMessage("Zonk. Coba Lagi."); }
                if (winTotal > 0) updateBalance(currentBalance + winTotal, true);
                setWinAmount(winTotal);
                setIsSpinning(false);
            };
            React.useEffect(() => { if (isAuto && !isSpinning) { const timer = setTimeout(() => { spin(); }, 500); return () => clearTimeout(timer); } }, [isAuto, isSpinning, balance]);
            return (
                <div className={`relative w-full max-w-2xl mx-auto ${showBigWin ? 'shake-screen' : ''}`}>{showBigWin && (<div className="absolute inset-0 z-50 flex flex-col items-center justify-center bg-black/80 rounded-3xl big-win-overlay pointer-events-none"><h1 className="text-6xl font-black text-yellow-400 drop-shadow-[0_0_15px_rgba(234,179,8,1)] font-cyber mb-2">BIG WIN</h1><div className="text-4xl font-bold text-white animate-bounce">+{winAmount.toLocaleString()}</div><div className="absolute top-0 left-10 coin" style={{animationDelay:'0s'}}></div><div className="absolute top-0 right-20 coin" style={{animationDelay:'0.5s'}}></div><div className="absolute top-0 left-1/2 coin" style={{animationDelay:'1s'}}></div></div>)}<div className="bg-gradient-to-b from-yellow-600 via-purple-900 to-black p-1.5 rounded-3xl shadow-[0_0_50px_rgba(234,179,8,0.4)]"><div className="bg-slate-900 rounded-[20px] p-4 border-4 border-yellow-500/50 relative overflow-hidden"><div className="grid grid-cols-5 gap-2 mb-6 bg-slate-800 p-2 rounded border border-slate-700 relative" style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)' }}><div className="absolute top-1/2 left-0 w-full h-0.5 bg-red-600 z-10 shadow-[0_0_5px_rgba(239,68,68,0.8)] pointer-events-none"></div>{grid.map((reel, i) => (<div key={i} className="flex flex-col gap-1 overflow-hidden h-[240px] bg-slate-900 rounded border border-slate-700">{reel.map((s, j) => (<div key={j} className={`h-[80px] flex items-center justify-center text-4xl bg-gradient-to-b from-slate-800 to-slate-950 border-b border-slate-800 ${isSpinning ? 'blur-[2px]' : ''}`}><span className={`filter drop-shadow-md ${s.color}`}>{s.icon}</span></div>))}</div>))}</div><BetControl bet={bet} setBet={setBet} balance={balance} /><div className="flex gap-3"><button onClick={() => setIsAuto(!isAuto)} className={`flex-1 py-4 rounded-xl font-bold font-cyber ${isAuto?'bg-red-600 animate-pulse':'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}>{isAuto?'STOP':'AUTO'}</button><button onClick={() => {if(!isAuto) spin()}} disabled={isSpinning || isAuto || balance < bet} className="flex-[2] py-4 rounded-xl font-black font-cyber bg-gradient-to-r from-yellow-500 to-orange-600 text-black shadow-lg hover:brightness-110 disabled:opacity-50 disabled:cursor-not-allowed text-xl tracking-widest">SPIN</button></div></div></div></div>
            );
        }

        function GameWheel({ balance, updateBalance, setWinMessage }) {
            const [rotation, setRotation] = React.useState(0); const [isSpinning, setIsSpinning] = React.useState(false); const [bet, setBet] = React.useState(500);
            const segments = [{ val: 0, color: '#ef4444', label: 'ZONK' }, { val: 2, color: '#3b82f6', label: 'x2' }, { val: 0, color: '#ef4444', label: 'ZONK' }, { val: 5, color: '#22c55e', label: 'x5' }, { val: 0, color: '#ef4444', label: 'ZONK' }, { val: 10, color: '#eab308', label: 'x10' }, { val: 0, color: '#ef4444', label: 'ZONK' }, { val: 0.5, color: '#a855f7', label: 'x0.5' }];
            const spin = async () => { if (balance < bet) return setWinMessage("Saldo Kurang!"); updateBalance(balance - bet); setIsSpinning(true); setWinMessage("Putar..."); const spins = 5; const randomIndex = Math.floor(Math.random() * segments.length); const segmentAngle = 360 / segments.length; const targetRotation = (spins * 360) + (360 - (randomIndex * segmentAngle)); const randomOffset = (Math.random() - 0.5) * 30; const finalRot = rotation + targetRotation + randomOffset; setRotation(finalRot); setTimeout(() => { const winSeg = segments[randomIndex]; const win = bet * winSeg.val; updateBalance(balance - bet + win, true); if(win > 0) setWinMessage(`Dapat ${winSeg.label} (+${win.toLocaleString()})`); else setWinMessage("Zonk! Coba lagi."); setIsSpinning(false); }, 5000); };
            return (<div className="flex flex-col items-center w-full max-w-md"><div className="relative w-72 h-72 mb-8"><div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-4 z-30 text-yellow-400 filter drop-shadow-lg"><Icons.MapPin className="w-12 h-12 transform rotate-180 fill-current" /></div><div className="w-full h-full rounded-full border-8 border-slate-800 relative overflow-hidden wheel-container shadow-[0_0_30px_rgba(0,0,0,0.5)]" style={{ transform: `rotate(${rotation}deg)`, background: `conic-gradient(#ef4444 0% 12.5%, #3b82f6 12.5% 25%, #ef4444 25% 37.5%, #22c55e 37.5% 50%, #ef4444 50% 62.5%, #eab308 62.5% 75%, #ef4444 75% 87.5%, #a855f7 87.5% 100%)` }}>{segments.map((seg, i) => (<div key={i} className="absolute w-full h-full top-0 left-0" style={{ transform: `rotate(${i * 45 + 22.5}deg)` }}> <div className="absolute top-2 left-1/2 -translate-x-1/2 text-center font-bold font-cyber text-white drop-shadow-md text-sm">{seg.label}</div></div>))}<div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-slate-900 rounded-full border-4 border-yellow-500 shadow-lg flex items-center justify-center z-20"><span className="font-cyber text-yellow-500 font-bold">SPIN</span></div></div></div><BetControl bet={bet} setBet={setBet} balance={balance} /><button onClick={spin} disabled={isSpinning || balance < bet} className="w-full py-4 bg-gradient-to-r from-pink-600 to-purple-600 rounded-xl font-black font-cyber text-white shadow-lg hover:scale-105 transition disabled:opacity-50 disabled:hover:scale-100">PUTAR</button></div>);
        }

        function GameHighLow({ balance, updateBalance, setWinMessage }) {
            const [currentNum, setCurrentNum] = React.useState(Math.floor(Math.random()*13)+1); const [nextNum, setNextNum] = React.useState(null); const [status, setStatus] = React.useState('Tebak Angka Berikutnya'); const [isFlipped, setIsFlipped] = React.useState(false); const [isLoading, setIsLoading] = React.useState(false); const [resultClass, setResultClass] = React.useState(''); const [bet, setBet] = React.useState(200); 
            const guess = (isHigher) => { if (balance < bet) return setWinMessage("Saldo Kurang!"); if (isLoading) return; updateBalance(balance - bet); setIsLoading(true); setStatus('Menganalisis...'); setWinMessage('...'); setResultClass(''); const next = Math.floor(Math.random()*13)+1; setNextNum(next); setTimeout(() => { setIsFlipped(true); setTimeout(() => { let win = false; if (isHigher && next > currentNum) win = true; if (!isHigher && next < currentNum) win = true; if (win) { const winAmount = bet * 2; updateBalance(balance - bet + winAmount, true); setStatus('BENAR!'); setWinMessage(`Win +${winAmount.toLocaleString()}`); setResultClass('win'); } else { setStatus('SALAH!'); setWinMessage(`Kalah -${bet.toLocaleString()}`); setResultClass('lose'); } setTimeout(() => { setIsFlipped(false); setTimeout(() => { setCurrentNum(next); setNextNum(null); setStatus('Tebak Angka Berikutnya'); setResultClass(''); setIsLoading(false); }, 800); }, 2000); }, 600); }, 500); };
            return (<div className="text-center p-8 bg-slate-900/80 rounded-3xl border border-blue-500/30 max-w-md mx-auto shadow-[0_0_30px_rgba(59,130,246,0.2)]"><h3 className="text-blue-400 font-cyber text-2xl mb-6 tracking-wider">DECRYPT_CODE</h3><div className="flex justify-center items-center gap-8 mb-8 h-48"><div className="w-32 h-48 bg-gradient-to-br from-slate-700 to-slate-800 rounded-2xl border-2 border-slate-600 flex items-center justify-center shadow-lg"><span className="text-6xl font-bold font-cyber text-white">{currentNum}</span></div><div className={`w-32 h-48 highlow-card relative ${isFlipped ? 'flipped' : ''}`}><div className="highlow-card-inner"><div className="highlow-card-front flex flex-col items-center justify-center"><Icons.Lock className="w-12 h-12 text-slate-500 mb-2" /><span className="text-sm text-slate-400 font-cyber">UNKNOWN</span></div><div className={`highlow-card-back ${resultClass}`}>{nextNum}</div></div></div></div><p className="text-slate-300 mb-6 h-6 font-bold">{status}</p><BetControl bet={bet} setBet={setBet} balance={balance} /><div className="flex gap-4 justify-center"><button onClick={() => guess(false)} disabled={isLoading || balance < bet} className="flex-1 py-4 bg-red-600/80 rounded-xl font-bold font-cyber hover:bg-red-500 transition disabled:opacity-50 flex items-center justify-center gap-2 border-b-4 border-red-800 active:border-b-0 active:translate-y-1 disabled:cursor-not-allowed"><Icons.ArrowDown/> LEBIH KECIL</button><button onClick={() => guess(true)} disabled={isLoading || balance < bet} className="flex-1 py-4 bg-green-600/80 rounded-xl font-bold font-cyber hover:bg-green-500 transition disabled:opacity-50 flex items-center justify-center gap-2 border-b-4 border-green-800 active:border-b-0 active:translate-y-1 disabled:cursor-not-allowed"><Icons.TrendingUp/> LEBIH BESAR</button></div><p className="mt-6 text-xs text-slate-400 font-cyber">Hadiah: 2x Lipat Modal</p></div>);
        }

        function GameDice({ balance, updateBalance, setWinMessage }) {
            const [dice, setDice] = React.useState([1, 1]); const [isRolling, setIsRolling] = React.useState(false); const [bet, setBet] = React.useState(200); const [prediction, setPrediction] = React.useState(null); 
            const roll = async (pred) => { if (balance < bet) return setWinMessage("Saldo Kurang!"); updateBalance(balance - bet); setIsRolling(true); setPrediction(pred); setWinMessage("Rolling..."); let tempDice = [1, 1]; const interval = setInterval(() => { tempDice = [Math.ceil(Math.random()*6), Math.ceil(Math.random()*6)]; setDice(tempDice); }, 100); setTimeout(() => { clearInterval(interval); const finalDice = [Math.ceil(Math.random()*6), Math.ceil(Math.random()*6)]; setDice(finalDice); const sum = finalDice[0] + finalDice[1]; let win = 0; let result = ""; if (sum === 7) result = 'seven'; else if (sum < 7) result = 'low'; else result = 'high'; if (pred === result) { const multiplier = pred === 'seven' ? 5 : 2; win = bet * multiplier; updateBalance(balance - bet + win, true); setWinMessage(`Win +${win.toLocaleString()}!`); } else { setWinMessage(`Kalah -${bet.toLocaleString()}`); } setIsRolling(false); }, 2000); };
            return (<div className="text-center p-8 bg-slate-900/80 rounded-3xl border border-purple-500/30 max-w-md mx-auto shadow-[0_0_30px_rgba(168,85,247,0.2)]"><h3 className="text-purple-400 font-cyber text-2xl mb-6 tracking-wider">COSMIC DICE</h3><div className="flex justify-center gap-6 mb-8">{dice.map((d, i) => (<div key={i} className={`w-20 h-20 bg-gradient-to-br from-indigo-600 to-purple-800 rounded-2xl flex items-center justify-center text-4xl font-bold text-white shadow-lg border-2 border-white/20 ${isRolling ? 'animate-bounce' : ''}`}>{d}</div>))}</div><div className="text-white mb-4 font-bold text-xl">Total: {dice[0] + dice[1]}</div><BetControl bet={bet} setBet={setBet} balance={balance} /><div className="grid grid-cols-3 gap-2"><button onClick={() => roll('low')} disabled={isRolling || balance < bet} className="p-3 bg-blue-600 rounded-xl font-bold text-sm hover:bg-blue-500 disabled:opacity-50">2-6 (x2)</button><button onClick={() => roll('seven')} disabled={isRolling || balance < bet} className="p-3 bg-yellow-600 rounded-xl font-bold text-sm hover:bg-yellow-500 disabled:opacity-50">7 (x5)</button><button onClick={() => roll('high')} disabled={isRolling || balance < bet} className="p-3 bg-red-600 rounded-xl font-bold text-sm hover:bg-red-500 disabled:opacity-50">8-12 (x2)</button></div></div>);
        }

        function GameRocket({ balance, updateBalance, setWinMessage }) {
            const [multiplier, setMultiplier] = React.useState(1.00); const [isFlying, setIsFlying] = React.useState(false); const [crashed, setCrashed] = React.useState(false); const [bet, setBet] = React.useState(200); const [cashedOut, setCashedOut] = React.useState(false);
            const intervalRef = React.useRef(null); // FIX: Ref to prevent leak

            const startGame = () => { 
                if (balance < bet) return setWinMessage("Saldo Kurang!"); 
                updateBalance(balance - bet); 
                setIsFlying(true); setCrashed(false); setCashedOut(false); setMultiplier(1.00); setWinMessage("Roket Meluncur!"); 
                const crashPoint = 1 + Math.random() * 5; 
                let currentMult = 1.00; 
                
                intervalRef.current = setInterval(() => { 
                    if (currentMult >= crashPoint) { 
                        clearInterval(intervalRef.current); 
                        setCrashed(true); setIsFlying(false); 
                        if (!cashedOut) setWinMessage("MELEDAK! Kalah."); 
                    } else { 
                        currentMult += 0.05; 
                        setMultiplier(parseFloat(currentMult.toFixed(2))); 
                    } 
                }, 100); 
            };
            
            // Cleanup on unmount
            React.useEffect(() => {
                return () => { if (intervalRef.current) clearInterval(intervalRef.current); };
            }, []);

            const cashOut = () => { 
                if (!isFlying || crashed || cashedOut) return; 
                const win = Math.floor(bet * multiplier); 
                updateBalance(balance - bet + win, true); 
                setCashedOut(true); setWinMessage(`Cashout! +${win.toLocaleString()}`); 
            };
            
            return (<div className="text-center p-8 bg-slate-900/80 rounded-3xl border border-orange-500/30 max-w-md mx-auto shadow-[0_0_30px_rgba(249,115,22,0.2)]"><h3 className="text-orange-400 font-cyber text-2xl mb-6 tracking-wider">ROCKET CRASH</h3><div className="h-40 flex items-center justify-center mb-4 relative bg-slate-950 rounded-xl border border-slate-800 overflow-hidden">{crashed ? <div className="text-red-500 text-4xl font-black animate-pulse">CRASHED!</div> : <div className={`text-5xl font-bold ${cashedOut ? 'text-green-400' : 'text-white'} ${isFlying ? 'rocket-anim' : ''}`}>{multiplier.toFixed(2)}x</div>}{isFlying && !crashed && <div className="absolute bottom-4"><Icons.Zap className="w-6 h-6 text-orange-500 animate-bounce"/></div>}</div><BetControl bet={bet} setBet={setBet} balance={balance} />{isFlying && !crashed && !cashedOut ? (<button onClick={cashOut} className="w-full py-4 bg-green-500 hover:bg-green-400 text-black font-bold rounded-xl shadow-lg text-xl">AMBIL {Math.floor(bet * multiplier).toLocaleString()}</button>) : (<button onClick={startGame} disabled={isFlying} className="w-full py-4 bg-orange-600 hover:bg-orange-500 text-white font-bold rounded-xl shadow-lg disabled:opacity-50">LUNCURKAN</button>)}</div>);
        }

        function GameHorseRace({ balance, updateBalance, setWinMessage }) {
            const [bet, setBet] = React.useState(200);
            const [selectedHorse, setSelectedHorse] = React.useState(null);
            const [raceStatus, setRaceStatus] = React.useState('idle'); 
            const [positions, setPositions] = React.useState([0,0,0,0,0]);
            const [winner, setWinner] = React.useState(null);
            const [commentary, setCommentary] = React.useState("Pilih kuda jagoanmu!");
            
            const horses = [
                { id: 0, name: "Thunder Bolt", color: "bg-red-500" },
                { id: 1, name: "Shadow Run", color: "bg-blue-500" },
                { id: 2, name: "Golden Boy", color: "bg-yellow-500" },
                { id: 3, name: "Wind Walker", color: "bg-green-500" },
                { id: 4, name: "Dark Knight", color: "bg-purple-500" }
            ];

            const startRace = () => {
                if (balance < bet) return setWinMessage("Saldo Kurang!");
                if (selectedHorse === null) return setWinMessage("Pilih Kuda Dulu!");
                
                updateBalance(balance - bet);
                setRaceStatus('racing');
                setPositions([0,0,0,0,0]);
                setWinner(null);
                setCommentary("Dan mereka mulai berlari!");

                const interval = setInterval(() => {
                    setPositions(prev => {
                        const newPos = prev.map(p => p + Math.random() * 3 + 0.5);
                        const winningIndex = newPos.findIndex(p => p >= 90);
                        if (winningIndex !== -1) {
                            clearInterval(interval);
                            finishRace(winningIndex);
                        }
                        
                        // Random commentary
                        if(Math.random() > 0.8) {
                            const leader = newPos.indexOf(Math.max(...newPos));
                            setCommentary(`${horses[leader].name} memimpin di depan!`);
                        }
                        
                        return newPos;
                    });
                }, 100);
            };

            const finishRace = (winnerIdx) => {
                setRaceStatus('finished');
                setPositions(prev => {
                    const final = [...prev];
                    final[winnerIdx] = 100; // Finish line
                    return final;
                });
                setWinner(winnerIdx);

                if (winnerIdx === selectedHorse) {
                    const win = bet * 10;
                    updateBalance(balance - bet + win, true);
                    setWinMessage(`MENANG! +${win.toLocaleString()}`);
                    setCommentary(`LUAR BIASA! ${horses[winnerIdx].name} Juara!`);
                } else {
                    setWinMessage(`Kalah -${bet.toLocaleString()}`);
                    setCommentary(`Sayang sekali, ${horses[winnerIdx].name} yang menang.`);
                }
                
                setTimeout(() => setRaceStatus('idle'), 4000);
            };

            return (
                <div className="w-full max-w-2xl mx-auto bg-slate-900/80 p-6 rounded-3xl border border-green-800 shadow-2xl">
                    <h3 className="text-green-400 font-cyber text-2xl mb-4 tracking-wider text-center">DERBY RAJA</h3>
                    <div className="bg-slate-800 p-4 rounded-xl mb-6 border border-slate-700 relative overflow-hidden race-track">
                         <div className="absolute right-10 top-0 bottom-0 w-1 bg-white/30 dashed"></div> {/* Finish Line */}
                         {horses.map((h, i) => (
                             <div key={i} className="mb-4 last:mb-0 relative h-8">
                                 <div className="absolute top-0 left-0 w-full h-full flex items-center px-2">
                                     <div className="w-full h-0.5 bg-slate-600"></div>
                                 </div>
                                 <div 
                                     className={`absolute top-0 h-8 w-8 rounded-full ${h.color} flex items-center justify-center text-xs font-bold text-white shadow-lg transition-all duration-100 border-2 border-white`}
                                     style={{ left: `${Math.min(positions[i], 92)}%` }}
                                 >
                                     <Icons.Horse className="w-5 h-5" />
                                 </div>
                             </div>
                         ))}
                    </div>

                    <div className="text-center mb-6 h-8 text-yellow-400 font-bold animate-pulse">{commentary}</div>

                    {/* Betting Controls */}
                    <div className={`transition-opacity duration-500 ${raceStatus !== 'idle' ? 'opacity-50 pointer-events-none' : 'opacity-100'}`}>
                        <div className="grid grid-cols-5 gap-2 mb-4">
                            {horses.map((h, i) => (
                                <button 
                                    key={i} 
                                    onClick={() => setSelectedHorse(i)}
                                    className={`p-2 rounded-lg border-2 flex flex-col items-center gap-1 transition-all ${selectedHorse === i ? 'border-yellow-400 bg-slate-700 scale-105' : 'border-transparent bg-slate-800 hover:bg-slate-700'}`}
                                >
                                    <div className={`w-8 h-8 rounded-full ${h.color} flex items-center justify-center text-white`}><Icons.Horse /></div>
                                    <span className="text-[10px] font-bold truncate w-full text-center">{h.name}</span>
                                </button>
                            ))}
                        </div>
                        <BetControl bet={bet} setBet={setBet} balance={balance} />
                        <button onClick={startRace} disabled={raceStatus !== 'idle'} className="w-full py-4 bg-gradient-to-r from-green-600 to-teal-600 rounded-xl font-black font-cyber text-white shadow-lg hover:scale-105 transition">
                            {raceStatus === 'idle' ? 'MULAI BALAPAN' : 'BALAPAN SEDANG BERLANGSUNG...'}
                        </button>
                    </div>
                </div>
            );
        }

        function GameSoccer({ balance, updateBalance, setWinMessage }) {
            const [bet, setBet] = React.useState(500);
            const [selectedTeam, setSelectedTeam] = React.useState(null);
            const [matchStatus, setMatchStatus] = React.useState('idle'); // idle, playing, finished
            const [currentRound, setCurrentRound] = React.useState(null); // 16, 8, 4, 2 (Final)
            const [matchLog, setMatchLog] = React.useState([]);
            
            // 16 Teams with simplified "Strength"
            const teams = [
                { id: 1, name: "Real Madrid", str: 90 }, { id: 2, name: "Man City", str: 89 },
                { id: 3, name: "Bayern Munich", str: 88 }, { id: 4, name: "Liverpool", str: 87 },
                { id: 5, name: "PSG", str: 86 }, { id: 6, name: "Barcelona", str: 86 },
                { id: 7, name: "Inter Milan", str: 85 }, { id: 8, name: "Arsenal", str: 85 },
                { id: 9, name: "Dortmund", str: 82 }, { id: 10, name: "Atletico", str: 83 },
                { id: 11, name: "Juventus", str: 82 }, { id: 12, name: "AC Milan", str: 81 },
                { id: 13, name: "Leverkusen", str: 84 }, { id: 14, name: "Benfica", str: 79 },
                { id: 15, name: "Ajax", str: 78 }, { id: 16, name: "Porto", str: 78 }
            ];

            const simulateMatch = (teamA, teamB) => {
                // Simple probability based on strength
                const totalStr = teamA.str + teamB.str;
                const chanceA = teamA.str / totalStr;
                const winner = Math.random() < chanceA ? teamA : teamB;
                const loser = winner === teamA ? teamB : teamA;
                const scoreW = Math.floor(Math.random() * 3) + 1;
                const scoreL = Math.floor(Math.random() * scoreW);
                return { winner, loser, score: `${winner.name} ${scoreW} - ${scoreL} ${loser.name}` };
            };

            const startTournament = async () => {
                if (balance < bet) return setWinMessage("Saldo Kurang!");
                if (!selectedTeam) return setWinMessage("Pilih Tim Jagoan!");

                updateBalance(balance - bet);
                setMatchStatus('playing');
                setMatchLog([]);
                
                let currentPool = [...teams];
                const myTeam = teams.find(t => t.id === selectedTeam);
                
                // Simulate Rounds
                const rounds = ["Babak 16 Besar", "Perempat Final", "Semi Final", "GRAND FINAL"];
                
                for (let r = 0; r < rounds.length; r++) {
                    setCurrentRound(rounds[r]);
                    let nextPool = [];
                    let roundLog = [];
                    
                    // Check if my team is still in
                    const myTeamIn = currentPool.find(t => t.id === myTeam.id);
                    if (!myTeamIn) {
                        setMatchLog(prev => [...prev, "Tim anda telah GUGUR!"]);
                        break; // Stop simulation if user lost
                    }

                    await new Promise(res => setTimeout(res, 1500)); // Suspense delay

                    // Shuffle pool for random matchups
                    currentPool.sort(() => Math.random() - 0.5);

                    for (let i = 0; i < currentPool.length; i += 2) {
                        const result = simulateMatch(currentPool[i], currentPool[i+1]);
                        nextPool.push(result.winner);
                        
                        // Add to log if it involves user team or is semi/final
                        if (result.winner.id === myTeam.id || result.loser.id === myTeam.id || r >= 2) {
                             setMatchLog(prev => [...prev, `${rounds[r]}: ${result.score}`]);
                        }
                    }
                    currentPool = nextPool;
                }

                // Check Final Result
                setMatchStatus('finished');
                if (currentPool[0].id === myTeam.id) {
                    const win = bet * 20;
                    updateBalance(balance - bet + win, true);
                    setWinMessage(`JUARA! +${win.toLocaleString()}`);
                    setMatchLog(prev => [...prev, `ðŸ† ${myTeam.name} ADALAH JUARA EROPA! ðŸ†`]);
                } else {
                    setWinMessage(`Kalah -${bet.toLocaleString()}`);
                    const winner = currentPool[0] ? currentPool[0].name : "Lawan";
                     setMatchLog(prev => [...prev, `Juara Turnamen: ${winner}`]);
                }
            };

            return (
                <div className="w-full max-w-2xl mx-auto bg-slate-900/80 p-6 rounded-3xl border border-blue-800 shadow-2xl">
                    <h3 className="text-blue-400 font-cyber text-2xl mb-4 tracking-wider text-center">LIGA JUARA EROPA</h3>
                    
                    <div className="text-center mb-6 bg-black/30 p-3 rounded-lg border border-white/10 text-xs text-slate-300">
                        <p>Selamat datang di Liga Juara Eropa! Di sini, 16 tim terbaik benua biru akan bertanding memperebutkan trofi paling bergengsi. Anda hanya perlu memilih SATU tim yang menurut Anda akan menjadi juara. Tim dengan reputasi besar memiliki statistik lebih kuat, tapi bola itu bundar! Jika tim pilihan Anda berhasil mengangkat piala di akhir turnamen, uang Anda akan dikalikan <strong>20 KALI LIPAT</strong>!</p>
                    </div>

                    {/* Stadium Screen */}
                    <div className="bg-black p-4 rounded-xl mb-6 border-4 border-slate-700 h-48 flex flex-col items-center justify-center relative overflow-hidden">
                        <div className="absolute inset-0 bg-[url('https://img.freepik.com/free-vector/soccer-stadium-with-illumination_1284-16528.jpg')] bg-cover opacity-20"></div>
                        
                        {matchStatus === 'idle' && <div className="z-10 text-slate-400 text-center">Pilih Tim & Mulai Turnamen<br/><span className="text-yellow-500 text-xs">Hadiah Juara x20</span></div>}
                        
                        {matchStatus === 'playing' && (
                            <div className="z-10 text-center w-full">
                                <div className="text-yellow-400 font-bold text-sm mb-2 animate-pulse">{currentRound}</div>
                                <div className="space-y-1 w-full px-4">
                                    {matchLog.slice(-3).map((log, i) => (
                                        <div key={i} className="text-white text-xs bg-black/50 p-1 rounded animate-fade-in">{log}</div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {matchStatus === 'finished' && (
                            <div className="z-10 text-center">
                                <div className="text-2xl font-bold text-white mb-2">TURNAMEN SELESAI</div>
                                <div className="text-yellow-400 font-cyber">{matchLog[matchLog.length-1]}</div>
                                <button onClick={() => setMatchStatus('idle')} className="mt-4 px-4 py-1 bg-blue-600 rounded text-xs">Reset</button>
                            </div>
                        )}
                    </div>

                    {/* Team Selection */}
                    <div className={`transition-opacity duration-500 ${matchStatus !== 'idle' ? 'opacity-50 pointer-events-none' : 'opacity-100'}`}>
                        <div className="grid grid-cols-4 gap-2 mb-4 max-h-40 overflow-y-auto pr-1">
                            {teams.map((t) => (
                                <button 
                                    key={t.id} 
                                    onClick={() => setSelectedTeam(t.id)}
                                    className={`p-2 rounded border text-xs font-bold transition-all ${selectedTeam === t.id ? 'bg-blue-600 border-blue-400 text-white' : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700'}`}
                                >
                                    {t.name}
                                </button>
                            ))}
                        </div>
                        <BetControl bet={bet} setBet={setBet} balance={balance} />
                        <button onClick={startTournament} className="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl font-black font-cyber text-white shadow-lg hover:scale-105 transition">
                            MULAI TURNAMEN
                        </button>
                    </div>
                </div>
            );
        }

        // --- MINIGAME EVENTS (30s & Claim System) ---
        function MinigameResult({ score, multiplier, onClaim }) {
            const total = score * multiplier;
            return (
                <div className="absolute inset-0 z-20 bg-slate-900/95 flex flex-col items-center justify-center animate-fade-in p-6 text-center">
                    <h2 className="text-3xl font-black text-yellow-400 mb-2">MISI SELESAI!</h2>
                    <div className="text-slate-400 mb-6">Skor Akhir: <span className="text-white font-bold">{score}</span></div>
                    <div className="bg-slate-800 p-6 rounded-2xl border-2 border-yellow-500/50 mb-8 w-full max-w-sm">
                        <div className="text-sm text-slate-400 uppercase mb-1">Total Hadiah</div>
                        <div className="text-4xl font-black text-green-400 animate-pulse">+{total.toLocaleString()}</div>
                        <div className="text-xs text-slate-500 mt-1">Credit</div>
                    </div>
                    <button onClick={() => onClaim(total)} className="w-full max-w-sm py-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold rounded-xl shadow-lg text-xl hover:scale-105 transition-transform">
                        KLAIM HADIAH
                    </button>
                </div>
            );
        }

        function EventBirdShooter({ onFinish }) {
            const [score, setScore] = React.useState(0);
            const [timeLeft, setTimeLeft] = React.useState(30); 
            const [birds, setBirds] = React.useState([]);
            const [isFinished, setIsFinished] = React.useState(false);

            React.useEffect(() => {
                if(isFinished) return;
                const timer = setInterval(() => setTimeLeft(t => {
                    if (t <= 1) { clearInterval(timer); setIsFinished(true); return 0; }
                    return t - 1;
                }), 1000);
                
                const spawner = setInterval(() => {
                    if (Math.random() > 0.3) {
                        const id = Date.now() + Math.random();
                        const top = Math.random() * 80 + 10;
                        const speed = Math.random() * 3 + 2;
                        setBirds(prev => [...prev, { id, top, left: -10, speed }]);
                    }
                }, 800);

                const mover = setInterval(() => {
                    setBirds(prev => prev.map(b => ({ ...b, left: b.left + b.speed })).filter(b => b.left < 110));
                }, 50);

                return () => { clearInterval(timer); clearInterval(spawner); clearInterval(mover); };
            }, [isFinished]);

            const shoot = (id) => {
                setBirds(prev => prev.filter(b => b.id !== id));
                setScore(s => s + 1);
            };

            return (
                <div className="relative w-full h-[400px] bg-slate-900 rounded-xl overflow-hidden border-2 border-blue-500 cursor-crosshair select-none animate-fade-in">
                    {isFinished ? <MinigameResult score={score} multiplier={50} onClaim={onFinish} /> : (
                        <>
                            <div className="absolute top-4 left-4 bg-black/50 px-4 py-2 rounded text-white font-bold z-10">Waktu: {timeLeft}s</div>
                            <div className="absolute top-4 right-4 bg-black/50 px-4 py-2 rounded text-yellow-400 font-bold z-10">Skor: {score} (Rp {score * 50})</div>
                            {birds.map(bird => (
                                <div key={bird.id} onMouseDown={() => shoot(bird.id)} className="absolute w-10 h-10 text-red-500 bird-target transition-transform active:scale-150" style={{ top: `${bird.top}%`, left: `${bird.left}%` }}>
                                    <Icons.Target />
                                </div>
                            ))}
                            <div className="absolute inset-0 pointer-events-none flex items-center justify-center text-slate-700/20 font-black text-6xl">CYBER HUNT</div>
                        </>
                    )}
                </div>
            );
        }

        function EventWhackAHacker({ onFinish }) {
            const [score, setScore] = React.useState(0);
            const [timeLeft, setTimeLeft] = React.useState(30); 
            const [activeHole, setActiveHole] = React.useState(null);
            const [isFinished, setIsFinished] = React.useState(false);

            React.useEffect(() => {
                if(isFinished) return;
                const timer = setInterval(() => setTimeLeft(t => {
                    if (t <= 1) { clearInterval(timer); setIsFinished(true); return 0; }
                    return t - 1;
                }), 1000);
                
                const popup = setInterval(() => {
                    setActiveHole(Math.floor(Math.random() * 9));
                    setTimeout(() => setActiveHole(null), 800);
                }, 1000);
                return () => { clearInterval(timer); clearInterval(popup); };
            }, [isFinished]);

            return (
                <div className="w-full bg-slate-900 p-4 rounded-xl border-2 border-red-500 select-none animate-fade-in h-[400px] relative">
                     {isFinished ? <MinigameResult score={score} multiplier={30} onClaim={onFinish} /> : (
                        <>
                            <div className="flex justify-between mb-8 text-white font-bold">
                                <span>Waktu: {timeLeft}s</span>
                                <span className="text-green-400">Dapat: {score * 30}</span>
                            </div>
                            <div className="grid grid-cols-3 gap-4">
                                {[...Array(9)].map((_, i) => (
                                    <div key={i} className="aspect-square bg-slate-800 rounded-full border-4 border-slate-700 relative overflow-hidden flex items-center justify-center cursor-pointer active:bg-slate-700" 
                                        onClick={() => { if (activeHole === i) { setScore(s => s + 1); setActiveHole(null); } }}>
                                        {activeHole === i && <div className="text-red-500 animate-bounce"><Icons.Skull className="w-12 h-12"/></div>}
                                    </div>
                                ))}
                            </div>
                        </>
                     )}
                </div>
            );
        }

        function EventCryptoMiner({ onFinish }) {
            const [clicks, setClicks] = React.useState(0);
            const [timeLeft, setTimeLeft] = React.useState(30);
            const [isFinished, setIsFinished] = React.useState(false);

            React.useEffect(() => {
                if(isFinished) return;
                const timer = setInterval(() => setTimeLeft(t => {
                    if (t <= 1) { clearInterval(timer); setIsFinished(true); return 0; }
                    return t - 1;
                }), 1000);
                return () => clearInterval(timer);
            }, [isFinished]);

            return (
                <div className="w-full h-[400px] bg-slate-900 rounded-xl border-2 border-green-500 flex flex-col items-center justify-center relative select-none animate-fade-in">
                    {isFinished ? <MinigameResult score={clicks} multiplier={5} onClaim={onFinish} /> : (
                        <>
                            <div className="absolute top-4 left-4 text-white font-bold">Waktu: {timeLeft}s</div>
                            <div className="text-6xl font-black text-green-500 mb-4 animate-pulse">{clicks}</div>
                            <div className="text-sm text-slate-400 mb-8">Total: {clicks * 5} Credits</div>
                            <button 
                                onMouseDown={() => setClicks(c => c + 1)}
                                className="w-32 h-32 rounded-full bg-gradient-to-br from-green-600 to-emerald-800 shadow-[0_0_30px_#22c55e] flex items-center justify-center active:scale-90 transition-transform"
                            >
                                <Icons.Zap className="w-16 h-16 text-white" />
                            </button>
                            <p className="mt-4 text-slate-300 animate-bounce">KLIK CEPAT!</p>
                        </>
                    )}
                </div>
            );
        }

        // --- SEARCH PAGE ---
        function SearchUserPage({ session }) {
            const [query, setQuery] = React.useState('');
            const [users, setUsers] = React.useState([]);
            const [loading, setLoading] = React.useState(false);
            const [selectedUser, setSelectedUser] = React.useState(null);
            const [page, setPage] = React.useState(0);
            const [hasMore, setHasMore] = React.useState(true);
            const PAGE_SIZE = 5;

            const fetchUsers = async (reset = false) => {
                setLoading(true);
                const currentPage = reset ? 0 : page;
                const from = currentPage * PAGE_SIZE;
                const to = from + PAGE_SIZE - 1;

                let dbQuery = supabase
                    .from('players')
                    .select('id, full_name, avatar_url, title, avatar_border, total_spins, created_at');

                if (query) {
                    dbQuery = dbQuery.ilike('full_name', `%${query}%`);
                }

                const { data, error } = await dbQuery
                    .order('created_at', { ascending: false })
                    .range(from, to);

                if (data) {
                    if (data.length < PAGE_SIZE) {
                        setHasMore(false);
                    } else {
                        setHasMore(true);
                    }

                    if (reset) {
                        setUsers(data);
                        setPage(1);
                    } else {
                        setUsers(prev => [...prev, ...data]);
                        setPage(prev => prev + 1);
                    }
                }
                setLoading(false);
            };

            React.useEffect(() => {
                fetchUsers(true);
            }, []);

            const handleSearch = (e) => {
                e.preventDefault();
                fetchUsers(true);
            };

            const handleLoadMore = () => {
                fetchUsers(false);
            };

            if (selectedUser) {
                const level = Math.floor((selectedUser.total_spins || 0) / 10);
                const joinDate = selectedUser.created_at ? new Date(selectedUser.created_at).toLocaleDateString() : '-';
                return (
                    <div className="max-w-lg mx-auto p-6 animate-fade-in">
                        <button onClick={() => setSelectedUser(null)} className="mb-6 text-slate-400 hover:text-white flex items-center gap-2"><Icons.ArrowLeft /> Kembali</button>
                        <div className="bg-slate-800 rounded-2xl border border-slate-700 overflow-hidden relative"><div className="h-32 bg-gradient-to-r from-blue-900 to-purple-900 relative"><div className="absolute inset-0 bg-black/20"></div></div><div className="px-6 pb-6 relative"><div className="flex justify-center -mt-16 mb-4"><div className={`w-32 h-32 rounded-full bg-slate-900 p-1 overflow-hidden ${getBorderClass(selectedUser.avatar_border)}`}><img src={selectedUser.avatar_url || `https://api.dicebear.com/9.x/dylan/svg?seed=${selectedUser.full_name}`} className="w-full h-full object-cover rounded-full bg-slate-800" /></div></div><div className="text-center mb-6"><h2 className="text-2xl font-bold text-white font-cyber">{selectedUser.full_name}</h2><div className="flex justify-center gap-2 mt-2"><span className="px-3 py-1 bg-yellow-500/20 text-yellow-400 text-xs font-bold rounded-full border border-yellow-500/30 uppercase">{selectedUser.title || 'Newbie'}</span><span className="px-3 py-1 bg-blue-500/20 text-blue-400 text-xs font-bold rounded-full border border-blue-500/30">LVL {level}</span></div></div><div className="grid grid-cols-2 gap-4 mb-6"><div className="bg-slate-900/50 p-4 rounded-xl text-center border border-slate-700/50"><div className="text-xs text-slate-500 uppercase mb-1">Total Spins</div><div className="text-xl font-bold text-white">{selectedUser.total_spins || 0}</div></div><div className="bg-slate-900/50 p-4 rounded-xl text-center border border-slate-700/50"><div className="text-xs text-slate-500 uppercase mb-1">Bergabung</div><div className="text-sm font-bold text-white mt-1">{joinDate}</div></div></div></div></div>
                    </div>
                );
            }

            return (
                <div className="max-w-2xl mx-auto p-6">
                    <h2 className="text-2xl font-cyber text-yellow-400 mb-6 border-b border-white/10 pb-4">Cari Pemain</h2>
                    <form onSubmit={handleSearch} className="flex gap-2 mb-8"><input value={query} onChange={e => setQuery(e.target.value)} placeholder="Cari nama user..." className="flex-1 bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-yellow-500 outline-none" /><button type="submit" className="bg-yellow-500 text-black px-6 rounded-xl font-bold hover:bg-yellow-400 flex items-center gap-2"><Icons.Search /> Cari</button></form>
                    <div className="grid gap-4">
                        {users.map((user, i) => (<div key={user.id} onClick={() => setSelectedUser(user)} className="bg-slate-800 p-4 rounded-xl border border-slate-700 flex items-center gap-4 cursor-pointer hover:bg-slate-700 transition group relative animate-fade-in"><div className={`w-16 h-16 rounded-full bg-slate-900 overflow-hidden ${getBorderClass(user.avatar_border)}`}><img src={user.avatar_url || `https://api.dicebear.com/9.x/dylan/svg?seed=${user.full_name}`} className="w-full h-full object-cover" /></div><div><div className="font-bold text-white text-lg group-hover:text-yellow-400 transition-colors">{user.full_name}</div><span className="text-xs bg-slate-900 px-2 py-1 rounded text-slate-400 font-bold uppercase border border-slate-600">{user.title || 'Newbie'}</span></div><div className="absolute right-4 text-slate-600 group-hover:text-white transition-colors"><Icons.ArrowLeft className="transform rotate-180"/></div></div>))}
                        {users.length === 0 && !loading && <div className="text-center text-slate-500 py-8">Tidak ada pemain ditemukan.</div>}
                        {loading && <div className="text-center text-slate-500 py-4">Memuat data...</div>}
                        {!loading && hasMore && (<button onClick={handleLoadMore} className="w-full py-3 mt-4 bg-slate-700 text-white font-bold rounded-xl hover:bg-slate-600 transition border border-slate-600">View More</button>)}
                    </div>
                </div>
            );
        }

        // --- LOBBY ---
        function Lobby({ setGame, onSelectEvent }) {
            const games = [
                { id: 'slot', name: 'Cyber Slots', icon: Icons.Play, color: 'from-yellow-600 to-red-600', desc: 'Classic Slot' },
                { id: 'wheel', name: 'Neon Wheel', icon: Icons.Disc, color: 'from-blue-600 to-purple-600', desc: 'Roulette' },
                { id: 'highlow', name: 'Code Breaker', icon: Icons.TrendingUp, color: 'from-green-600 to-emerald-800', desc: 'High/Low' },
                { id: 'dice', name: 'Cosmic Dice', icon: Icons.Dices, color: 'from-indigo-600 to-violet-800', desc: 'Dice Roll' },
                { id: 'rocket', name: 'Rocket Crash', icon: Icons.Rocket, color: 'from-orange-600 to-red-800', desc: 'Crash Game' },
                { id: 'horse', name: 'Derby Raja', icon: Icons.Horse, color: 'from-yellow-600 to-orange-700', desc: 'Balapan Kuda' },
                { id: 'soccer', name: 'Liga Juara', icon: Icons.Football, color: 'from-blue-600 to-indigo-800', desc: 'Judi Bola' }
            ];
            
            // Flashy Event Banners
            const eventBanners = [
                { id: 'hunt', title: "CYBER HUNT", desc: "Tembak Drone! Hadiah 50/hit", color: "bg-gradient-to-r from-blue-600 to-cyan-400", icon: Icons.Target },
                { id: 'hacker', title: "FIREWALL DEFENDER", desc: "Pukul Hacker! Hadiah 30/hit", color: "bg-gradient-to-r from-red-600 to-pink-600", icon: Icons.Skull },
                { id: 'miner', title: "DATA MINER", desc: "Klik Cepat! Hadiah 5/klik", color: "bg-gradient-to-r from-green-600 to-emerald-400", icon: Icons.Pickaxe },
            ];

            return (
                <div className="space-y-8 animate-fade-in">
                    <div className="bg-slate-800/50 rounded-2xl p-4 border border-yellow-500/30">
                        <h3 className="text-yellow-400 font-bold font-cyber mb-4 flex items-center gap-2"><span className="animate-pulse">ðŸŽ‰</span> LIVE EVENTS (GRATIS CREDIT) <span className="animate-pulse">ðŸŽ‰</span></h3>
                        <div className="w-full overflow-x-auto pb-4 snap-x flex gap-4 no-scrollbar">
                            {eventBanners.map(b => (
                                <div key={b.id} onClick={() => onSelectEvent(b.id)} className={`min-w-[85%] md:min-w-[45%] h-32 rounded-xl ${b.color} p-5 flex flex-col justify-center shadow-[0_0_20px_rgba(255,255,255,0.2)] snap-center relative overflow-hidden cursor-pointer transform transition hover:scale-105 border-2 border-white/20 group`}>
                                    <div className="absolute -right-4 -top-4 opacity-20 group-hover:opacity-40 transition-opacity transform rotate-12 scale-150 text-white">
                                        <b.icon width="100" height="100"/>
                                    </div>
                                    <h3 className="text-xl font-black text-white font-cyber z-10 drop-shadow-md">{b.title}</h3>
                                    <p className="text-white font-bold z-10 drop-shadow-sm">{b.desc}</p>
                                    <div className="absolute bottom-2 right-2 bg-black/30 px-2 py-1 rounded text-[10px] text-white font-bold border border-white/30">MAIN SEKARANG</div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div>
                        <h2 className="text-xl font-bold text-white mb-4 flex items-center gap-2 font-cyber text-yellow-500"><Icons.Play /> Game Pilihan</h2>
                        <div className="flex gap-4 overflow-x-auto pb-6 no-scrollbar snap-x">
                            {games.map(g => (
                                <button 
                                    key={g.id} 
                                    onClick={() => setGame(g.id)} 
                                    className={`min-w-[160px] w-[45%] md:w-[200px] aspect-[9/16] rounded-2xl bg-gradient-to-br ${g.color} p-4 flex flex-col items-center justify-between hover:scale-95 transition-transform shadow-xl border border-white/10 group snap-start relative overflow-hidden`}
                                >
                                    <div className="absolute inset-0 bg-black/10 group-hover:bg-transparent transition"></div>
                                    <div className="p-4 bg-black/30 rounded-full text-white group-hover:bg-white group-hover:text-black transition-colors z-10 mt-8">
                                        <g.icon />
                                    </div>
                                    <div className="text-center z-10 mb-4 w-full">
                                        <span className="font-bold font-cyber text-lg block truncate px-2">{g.name}</span>
                                        <span className="text-xs text-white/70 block mt-1 px-2 truncate">{g.desc}</span>
                                    </div>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // --- INFO PAGE ---
        function InfoPage() {
            const [expanded, setExpanded] = React.useState(null);
            const faqs = [
                { q: "Apakah chip bisa diuangkan?", a: "Tidak. Royal Cyber Casino adalah game simulasi (social casino). Chip hanya untuk hiburan." },
                { q: "Bagaimana cara naik level?", a: "Cukup bermain game apa saja. Setiap spin/putaran akan menambah XP Anda." },
                { q: "Apa keuntungan VIP/Casino King?", a: "Mendapatkan akses ke border avatar eksklusif dan prioritas support." },
                { q: "Apakah game ini adil?", a: "Ya, kami menggunakan algoritma RNG (Random Number Generator) standar industri." }
            ];
            return (
                <div className="max-w-3xl mx-auto p-6 space-y-8 animate-fade-in">
                    <div className="text-center space-y-2">
                        <h2 className="text-3xl font-cyber text-yellow-400 tracking-widest">ROYAL CYBER CASINO</h2>
                        <p className="text-slate-400 text-sm">The Future of Digital Entertainment</p>
                    </div>

                    <div className="bg-slate-800/50 p-6 rounded-xl border border-white/10 space-y-4">
                        <h3 className="text-xl font-bold text-white border-b border-white/10 pb-2">Tentang Kami</h3>
                        <p className="text-slate-300 text-sm leading-relaxed">
                            Royal Cyber Casino adalah platform simulasi kasino terdepan yang menggabungkan estetika Cyberpunk dengan sensasi permainan klasik. Kami menghadirkan pengalaman bermain yang adil, transparan, dan menghibur bagi seluruh pengguna.
                        </p>
                    </div>

                    <div className="grid md:grid-cols-2 gap-4">
                        <div className="bg-slate-800/50 p-6 rounded-xl border border-blue-500/30">
                            <h3 className="text-lg font-bold text-blue-400 mb-3">Visi Kami</h3>
                            <ul className="space-y-2 text-sm text-slate-300 list-disc pl-4">
                                <li>Menjadi platform simulasi #1 di Asia.</li>
                                <li>Menciptakan komunitas gamer yang solid.</li>
                                <li>Inovasi teknologi web realtime tercepat.</li>
                            </ul>
                        </div>
                        <div className="bg-slate-800/50 p-6 rounded-xl border border-green-500/30">
                            <h3 className="text-lg font-bold text-green-400 mb-3">Keamanan & Fair Play</h3>
                            <ul className="space-y-2 text-sm text-slate-300 list-disc pl-4">
                                <li>Enkripsi data SSL 256-bit.</li>
                                <li>Sistem anti-bot & anti-cheat canggih.</li>
                                <li>Transparansi riwayat transaksi penuh.</li>
                            </ul>
                        </div>
                    </div>

                    <div className="space-y-2">
                        <h3 className="text-lg font-bold text-white ml-2">FAQ (Tanya Jawab)</h3>
                        {faqs.map((f, i) => (
                            <div key={i} className="bg-slate-800 rounded-lg overflow-hidden">
                                <button onClick={() => setExpanded(expanded === i ? null : i)} className="w-full p-4 text-left flex justify-between items-center hover:bg-slate-700 transition">
                                    <span className="text-sm font-bold text-slate-200">{f.q}</span>
                                    <Icons.ArrowDown className={`transform transition ${expanded === i ? 'rotate-180' : ''} text-slate-500`} />
                                </button>
                                {expanded === i && <div className="p-4 pt-0 text-sm text-slate-400 border-t border-white/5">{f.a}</div>}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // --- PATTERN PAGE ---
        function PatternPage({ luckPercentage }) {
            const [time, setTime] = React.useState(new Date());
            React.useEffect(() => { const t = setInterval(() => setTime(new Date()), 60000); return () => clearInterval(t); }, []);

            const games = [
                { name: "Cyber Slots", rtp: 80 + Math.floor(Math.random() * 15), volatility: "High" },
                { name: "Neon Wheel", rtp: 90 + Math.floor(Math.random() * 8), volatility: "Med" },
                { name: "Code Breaker", rtp: 50, volatility: "Low" },
                { name: "Cosmic Dice", rtp: 95, volatility: "Med" },
                { name: "Rocket Crash", rtp: 98, volatility: "Extreme" },
            ];

            const luckyHours = [
                { time: "00:00 - 03:00", boost: "4x Luck (Malam)" },
                { time: "12:00 - 13:00", boost: "2x Luck (Siang)" },
                { time: "18:00 - 20:00", boost: "3x Luck (Sore)" }
            ];

            return (
                <div className="max-w-3xl mx-auto p-6 space-y-6">
                    <div>
                        <h2 className="text-2xl font-cyber text-yellow-400 mb-2">Statistik Keberuntungan</h2>
                        <div className="bg-slate-800 p-6 rounded-xl border border-yellow-500/30 relative overflow-hidden">
                            <div className="relative z-10">
                                <p className="text-slate-400 text-sm uppercase tracking-widest mb-2">Tingkat Keberuntungan Anda</p>
                                <div className="text-4xl font-black text-white">{luckPercentage}%</div>
                                <p className="text-xs text-slate-500 mt-2">Keberuntungan berkurang seiring pengalaman bermain (-1% tiap 50 spin).</p>
                            </div>
                            <div className="absolute right-0 top-0 w-32 h-32 bg-yellow-500/10 rounded-full blur-3xl"></div>
                        </div>
                    </div>

                    <div>
                        <h3 className="text-xl font-bold text-white mb-3 flex items-center gap-2"><Icons.Zap className="text-yellow-400"/> Jam Gacor (Lucky Hours)</h3>
                        <div className="grid md:grid-cols-3 gap-4">
                            {luckyHours.map((h, i) => (
                                <div key={i} className="bg-slate-800 p-4 rounded-xl border border-slate-700 text-center">
                                    <div className="font-bold text-white">{h.time}</div>
                                    <div className="text-xs text-green-400 mt-1">{h.boost}</div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div>
                        <h3 className="text-xl font-bold text-white mb-3">RTP Live Game</h3>
                        <p className="text-xs text-slate-400 mb-4 flex items-center gap-2"><span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> Update Terakhir: {time.toLocaleTimeString()}</p>
                        <div className="grid gap-4">
                            {games.map((g, i) => (
                                <div key={i} className="bg-slate-800 p-4 rounded-xl border border-slate-700 flex justify-between items-center relative overflow-hidden">
                                    <div className="z-10">
                                        <h3 className="font-bold text-white text-lg">{g.name}</h3>
                                        <span className={`text-xs px-2 py-0.5 rounded border ${g.volatility === 'High' || g.volatility === 'Extreme' ? 'border-red-500 text-red-400' : 'border-blue-500 text-blue-400'}`}>{g.volatility} Volatility</span>
                                    </div>
                                    <div className="text-right z-10">
                                        <div className="text-2xl font-bold text-green-400">{g.rtp}%</div>
                                        <div className="text-[10px] text-slate-500">Win Rate</div>
                                    </div>
                                    <div className="absolute bottom-0 left-0 h-1 bg-green-600 transition-all duration-1000" style={{ width: `${g.rtp}%` }}></div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // --- SHOP PAGE ---
        function ShopPage({ session, balance, updateBalance, profileData, refreshProfile }) {
            const [loading, setLoading] = React.useState(false);
            const [ownedItems, setOwnedItems] = React.useState([]);

            React.useEffect(() => {
                if (profileData && Array.isArray(profileData.inventory)) {
                    setOwnedItems(profileData.inventory);
                } else {
                    setOwnedItems(['default']);
                }
            }, [profileData]);

            const handleBuy = async (item) => {
                if (item.id === 'collector') return alert("Item ini tidak dijual! Dapatkan dengan mengoleksi semua border lain.");
                if (balance < item.price) return alert("Saldo tidak cukup!");
                if (!confirm(`Beli ${item.name} seharga ${item.price.toLocaleString()}?`)) return;

                setLoading(true);
                const newBalance = balance - item.price;
                let newInventory = [...ownedItems, item.id];

                const buyableItems = BORDER_CATALOG.filter(b => b.id !== 'default' && b.id !== 'collector');
                const ownedBuyable = buyableItems.filter(b => newInventory.includes(b.id));
                
                let newTitle = profileData.title;
                let earnedCollector = false;

                if (ownedBuyable.length === buyableItems.length) {
                    if (!newInventory.includes('collector')) {
                        newInventory.push('collector');
                        newTitle = 'The Collector';
                        earnedCollector = true;
                    }
                }

                const { error } = await supabase.from('players').update({ 
                    balance: newBalance,
                    inventory: newInventory,
                    title: newTitle
                }).eq('id', session.user.id);

                if (!error) {
                    updateBalance(newBalance);
                    setOwnedItems(newInventory);
                    refreshProfile(); 
                    if (earnedCollector) {
                        alert("SELAMAT! Anda telah mengoleksi semua item! Gelar 'The Collector' dan Border Spesial telah dibuka!");
                    } else {
                        alert("Pembelian Berhasil!");
                    }
                } else {
                    alert("Gagal beli: " + error.message);
                }
                setLoading(false);
            };

            const handleEquip = async (itemId) => {
                setLoading(true);
                const { error } = await supabase.from('players').update({ avatar_border: itemId }).eq('id', session.user.id);
                if (!error) {
                    refreshProfile(); 
                    alert("Border terpasang!");
                } else {
                    alert("Gagal pasang border: " + error.message);
                }
                setLoading(false);
            };

            return (
                <div className="max-w-6xl mx-auto p-6">
                    <div className="flex flex-col md:flex-row justify-between items-center mb-8 border-b border-white/10 pb-6 gap-4">
                        <div>
                            <h2 className="text-3xl font-cyber text-yellow-400">Avatar Shop</h2>
                            <p className="text-slate-400 text-sm mt-1">Koleksi semua untuk mendapatkan gelar 'The Collector'</p>
                        </div>
                        <div className="bg-slate-800 px-4 py-2 rounded-full border border-yellow-500/30">
                            <span className="text-slate-400 text-xs uppercase mr-2">Koleksi Anda</span>
                            <span className="text-yellow-400 font-bold">{ownedItems.length} / {BORDER_CATALOG.length}</span>
                        </div>
                    </div>
                    
                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                        {BORDER_CATALOG.map(item => {
                            const currentInv = Array.isArray(ownedItems) ? ownedItems : [];
                            const isOwned = currentInv.includes(item.id) || item.id === 'default';
                            const isEquipped = profileData.avatar_border === item.id || (item.id === 'default' && !profileData.avatar_border);
                            const isCollectorItem = item.id === 'collector';

                            return (
                                <div key={item.id} className={`bg-slate-800 p-4 rounded-xl border relative group transition hover:-translate-y-1 ${isCollectorItem ? 'border-yellow-500/50 bg-yellow-900/10' : 'border-slate-700 hover:border-yellow-500/30'}`}>
                                    {isCollectorItem && <div className="absolute top-2 right-2 text-yellow-500"><Icons.Crown /></div>}
                                    
                                    <div className="flex justify-center mb-3">
                                        <div className={`w-20 h-20 rounded-full bg-slate-700 overflow-hidden relative ${item.class}`}>
                                            <img src={profileData.avatar_url} className="w-full h-full object-cover opacity-80" />
                                        </div>
                                    </div>
                                    
                                    <div className="text-center mb-3">
                                        <h3 className={`font-bold text-sm truncate ${isCollectorItem ? 'text-yellow-400' : 'text-white'}`}>{item.name}</h3>
                                        <p className="text-[10px] text-slate-400">{item.price > 0 ? `${item.price.toLocaleString()} Chip` : 'Gratis'}</p>
                                    </div>

                                    {isEquipped ? (
                                        <button disabled className="w-full py-1.5 bg-green-600/20 text-green-400 border border-green-600/30 rounded-lg text-[10px] font-bold cursor-default">DIPAKAI</button>
                                    ) : isOwned ? (
                                        <button onClick={() => handleEquip(item.id)} disabled={loading} className="w-full py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-[10px] font-bold transition">PAKAI</button>
                                    ) : isCollectorItem ? (
                                        <button disabled className="w-full py-1.5 bg-slate-700 text-slate-500 rounded-lg text-[10px] font-bold cursor-not-allowed border border-slate-600">LOCKED</button>
                                    ) : (
                                        <button onClick={() => handleBuy(item)} disabled={loading || balance < item.price} className="w-full py-1.5 bg-yellow-600 hover:bg-yellow-500 text-white rounded-lg text-[10px] font-bold transition disabled:opacity-50">BELI</button>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }

        // --- GLOBAL CHAT ---
        function GlobalChat({ session, profileData }) {
            const [isOpen, setIsOpen] = React.useState(false);
            const [message, setMessage] = React.useState('');
            const [chats, setChats] = React.useState([]);
            const [image, setImage] = React.useState(null);
            const [isExpanded, setIsExpanded] = React.useState(false);
            const messagesEndRef = React.useRef(null);
            const fileRef = React.useRef(null);

            const scrollToBottom = () => messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });

            React.useEffect(() => {
                const fetchChats = async () => {
                    const { data } = await supabase.from('global_chat').select('*').order('created_at', { ascending: false }).limit(50);
                    if(data) setChats(data.reverse());
                };
                fetchChats();

                const subscription = supabase
                    .channel('public:global_chat')
                    .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'global_chat' }, (payload) => {
                        setChats(prev => [...prev, payload.new]);
                        setTimeout(scrollToBottom, 100);
                    })
                    .on('postgres_changes', { event: 'DELETE', schema: 'public', table: 'global_chat' }, (payload) => {
                        if (!payload.old.id) {
                             setChats([]);
                        } else {
                             setChats(prev => prev.filter(c => c.id !== payload.old.id));
                        }
                        fetchChats();
                    })
                    .subscribe();

                return () => supabase.removeChannel(subscription);
            }, []);

            React.useEffect(() => { if(isOpen) scrollToBottom(); }, [isOpen, chats]);

            const handleSend = async (e) => {
                e.preventDefault();
                if ((!message.trim() && !image) || !session) return;
                const newMessage = { user_id: session.user.id, user_email: session.user.email, user_name: profileData.full_name || 'Guest', user_avatar: profileData.avatar_url, message: message.trim(), image_url: image };
                setMessage(''); setImage(null);
                await supabase.from('global_chat').insert([newMessage]);
            };

            const handleImageSelect = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 2 * 1024 * 1024) return alert("Max Image 2MB");
                    const reader = new FileReader(); reader.onload = () => setImage(reader.result); reader.readAsDataURL(file);
                }
            };
            
            const handleClearAll = async () => {
                if(confirm("Hapus SEMUA pesan chat global? Tindakan ini tidak bisa dibatalkan.")) {
                    const { error } = await supabase.from('global_chat').delete().neq('id', '00000000-0000-0000-0000-000000000000'); 
                    if(error) alert("Gagal hapus chat");
                }
            }

            return (
                <>
                    <button onClick={() => setIsOpen(!isOpen)} className={`fixed bottom-4 right-4 z-50 p-4 rounded-full shadow-2xl transition-all transform hover:scale-110 ${isOpen ? 'bg-red-600 rotate-180' : 'bg-gradient-to-r from-blue-600 to-purple-600 animate-bounce'}`}>
                        {isOpen ? <Icons.Minimize className="text-white" /> : <Icons.Chat className="text-white" />}
                    </button>
                    {isOpen && (
                        <div className={`fixed z-50 bg-slate-900/95 backdrop-blur-md border border-white/10 rounded-2xl shadow-2xl flex flex-col animate-fade-in overflow-hidden transition-all duration-300 ${isExpanded ? 'inset-0 rounded-none' : 'bottom-20 right-4 w-full max-w-sm h-[500px]'}`}>
                            <div className="p-3 bg-gradient-to-r from-blue-900 to-purple-900 border-b border-white/10 flex justify-between items-center">
                                <h3 className="font-cyber font-bold text-white flex items-center gap-2"><span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> Global Chat</h3>
                                <div className="flex gap-2">
                                    {profileData.role === 'admin' && (
                                        <button onClick={handleClearAll} className="text-[10px] bg-red-600 px-2 py-1 rounded hover:bg-red-500 text-white flex items-center gap-1">
                                            <Icons.Trash />
                                        </button>
                                    )}
                                    <button onClick={() => setIsExpanded(!isExpanded)} className="text-white hover:text-yellow-400 transition">
                                        {isExpanded ? <Icons.Minimize /> : <Icons.Maximize />}
                                    </button>
                                    <button onClick={() => setIsOpen(false)} className="text-white hover:text-red-400"><Icons.X /></button>
                                </div>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-black/20">
                                {chats.map((chat, i) => {
                                    const isMe = chat.user_id === session.user.id;
                                    const isAdminMsg = chat.user_email === 'admin@royal.com' || (chat.user_name && chat.user_name.toLowerCase().includes('admin'));
                                    return (
                                        <div key={i} className={`flex gap-2 ${isMe ? 'flex-row-reverse' : ''} chat-bubble`}>
                                            <div className="flex-shrink-0"><img src={chat.user_avatar || `https://api.dicebear.com/9.x/dylan/svg?seed=${chat.user_name}`} className="w-8 h-8 rounded-full border border-white/20 bg-slate-800 object-cover" /></div>
                                            <div className={`max-w-[75%] ${isMe ? 'items-end' : 'items-start'} flex flex-col`}>
                                                <span className={`text-[10px] mb-0.5 ${isAdminMsg ? 'text-yellow-400 font-bold' : 'text-slate-400'} ${isMe ? 'text-right' : ''}`}>{chat.user_name} {isAdminMsg && 'ðŸ‘‘'}</span>
                                                <div className={`p-2 rounded-xl text-sm break-words ${isMe ? 'bg-blue-600 text-white rounded-tr-none' : isAdminMsg ? 'bg-yellow-900/50 border border-yellow-500/30 text-yellow-100 rounded-tl-none' : 'bg-slate-800 text-slate-200 rounded-tl-none'}`}>{chat.message}{chat.image_url && (<img src={chat.image_url} className="mt-2 rounded-lg max-h-32 w-full object-cover cursor-pointer hover:opacity-90" onClick={()=>window.open(chat.image_url)} />)}</div>
                                                <span className="text-[9px] text-slate-600 mt-0.5">{new Date(chat.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                                            </div>
                                        </div>
                                    );
                                })}
                                <div ref={messagesEndRef} />
                            </div>
                            {image && (<div className="px-4 pt-2 relative"><div className="bg-slate-800 rounded-lg p-2 flex items-center justify-between"><img src={image} className="h-10 w-10 object-cover rounded" /><button onClick={() => setImage(null)} className="text-red-400 text-xs hover:underline">Hapus</button></div></div>)}
                            <form onSubmit={handleSend} className="p-3 bg-slate-800 border-t border-white/10 flex gap-2 items-center">
                                <button type="button" onClick={() => fileRef.current.click()} className="p-2 text-slate-400 hover:text-blue-400 transition"><Icons.Image /></button>
                                <input type="file" ref={fileRef} className="hidden" accept="image/*" onChange={handleImageSelect} />
                                <input value={message} onChange={e => setMessage(e.target.value)} placeholder="Kirim pesan..." className="flex-1 bg-slate-900 border border-slate-700 rounded-full px-4 py-2 text-sm text-white focus:border-blue-500 outline-none"/>
                                <button type="submit" disabled={!message && !image} className="p-2 bg-blue-600 rounded-full text-white hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition transform active:scale-95"><Icons.Send /></button>
                            </form>
                        </div>
                    )}
                </>
            );
        }
        
        // --- DASHBOARD FIXED ---
        function Dashboard({ session, onLogout }) {
            const [view, setView] = React.useState('lobby'); 
            const [activeGame, setActiveGame] = React.useState(null);
            const [activeEvent, setActiveEvent] = React.useState(null);
            const [eventStage, setEventStage] = React.useState('intro'); // State for event intro screen
            const [balance, setBalance] = React.useState(0);
            const [winMessage, setWinMessage] = React.useState('Selamat Datang');
            const [profileData, setProfileData] = React.useState({ full_name: '', avatar_url: '', role: 'user', title: 'Newbie', total_spins: 0, avatar_border: 'default', inventory: ['default'] });

            const loadUserData = async () => {
                try {
                    const { data, error } = await supabase.from('players').select('*').eq('id', session.user.id).single();
                    if (data) { 
                        setBalance(data.balance); 
                        setProfileData({ 
                            full_name: data.full_name || 'Member', 
                            avatar_url: data.avatar_url, 
                            role: data.role || 'user',
                            title: data.title || 'Newbie',
                            total_spins: data.total_spins || 0,
                            avatar_border: data.avatar_border || 'default',
                            inventory: data.inventory || ['default']
                        }); 
                    }
                    else if (error && error.code === 'PGRST116') {
                        // FIX: Set balance awal jadi 50000
                        const initData = { id: session.user.id, balance: 50000, full_name: session.user.user_metadata?.full_name || 'Member', avatar_url: `https://api.dicebear.com/9.x/dylan/svg?seed=${session.user.email}`, role: 'user', title: 'Newbie', total_spins: 0, avatar_border: 'default', inventory: ['default'] };
                        await supabase.from('players').insert([initData]);
                        setBalance(50000); setProfileData(initData);
                    }
                } catch(e) {}
            };
            React.useEffect(() => { loadUserData(); }, [session]);

            const updateBalance = async (newBal, isSpin = false) => { 
                setBalance(newBal);
                const updates = { balance: newBal };
                if (isSpin) {
                    const newSpins = (profileData.total_spins || 0) + 1;
                    const newTitle = (newSpins >= 1000) ? 'Casino King' : (newSpins >= 500) ? 'High Roller' : (newSpins >= 50) ? 'Rookie' : 'Newbie';
                    updates.total_spins = newSpins;
                    updates.title = newTitle;
                    setProfileData(prev => ({ ...prev, total_spins: newSpins, title: newTitle }));
                }
                await supabase.from('players').update(updates).eq('id', session.user.id); 
            };
            
            const getBorderClass = (id) => {
                const item = BORDER_CATALOG.find(b => b.id === id);
                return item ? item.class : 'border-2 border-yellow-500';
            };

            const baseLuck = 80;
            const decay = Math.floor((profileData.total_spins || 0) / 50);
            const luckPercentage = Math.max(10, baseLuck - decay);
            
            const handleEventFinish = (earned) => {
                if (earned > 0) {
                    updateBalance(balance + earned);
                    alert(`Selamat! Anda mendapatkan ${earned} Credits!`);
                }
                setActiveEvent(null);
            };

            // Update handleSelectEvent to include setting eventStage
            const handleSelectEvent = (eventId) => {
                setActiveEvent(eventId);
                setEventStage('intro');
            };

            const renderContent = () => {
                let content = null;
                
                if (activeEvent) {
                    const eventDesc = EVENT_DESCRIPTIONS[activeEvent];
                    // Event Game Overlay
                    return (
                        <div className="fixed inset-0 z-50 bg-slate-900/95 flex items-center justify-center p-4 overflow-y-auto">
                             <div className="w-full max-w-2xl bg-slate-800 p-6 rounded-2xl border border-yellow-500/50 shadow-2xl relative">
                                <button onClick={() => setActiveEvent(null)} className="absolute top-4 right-4 text-slate-400 hover:text-white"><Icons.X /></button>
                                
                                {eventStage === 'intro' ? (
                                    <div className="text-center space-y-6 animate-fade-in">
                                        <h2 className="text-3xl font-cyber text-yellow-400 tracking-widest mb-2">{eventDesc.title}</h2>
                                        
                                        <div className="bg-slate-900/50 p-4 rounded-xl border border-blue-500/30 text-left">
                                            <h3 className="text-lg font-bold text-blue-400 mb-2 flex items-center gap-2"><Icons.Info/> Misi Kamu</h3>
                                            <p className="text-slate-300 text-sm leading-relaxed">{eventDesc.story}</p>
                                        </div>

                                        <div className="bg-slate-900/50 p-4 rounded-xl border border-green-500/30 text-left">
                                            <h3 className="text-lg font-bold text-green-400 mb-2 flex items-center gap-2"><Icons.Target/> Cara Bermain</h3>
                                            <p className="text-slate-300 text-sm leading-relaxed">{eventDesc.how}</p>
                                        </div>

                                        <button 
                                            onClick={() => setEventStage('playing')}
                                            className="w-full py-4 bg-gradient-to-r from-yellow-600 to-orange-600 text-white font-black text-xl rounded-xl shadow-lg hover:scale-105 transition-transform font-cyber tracking-widest mt-4"
                                        >
                                            MULAI MISI
                                        </button>
                                    </div>
                                ) : (
                                    <div className="animate-fade-in">
                                        <h2 className="text-xl font-cyber text-center text-yellow-400 mb-4">EVENT SEDANG BERLANGSUNG</h2>
                                        {activeEvent === 'hunt' && <EventBirdShooter onFinish={handleEventFinish} />}
                                        {activeEvent === 'hacker' && <EventWhackAHacker onFinish={handleEventFinish} />}
                                        {activeEvent === 'miner' && <EventCryptoMiner onFinish={handleEventFinish} />}
                                    </div>
                                )}
                            </div>
                        </div>
                    );
                }

                if (view === 'profile') content = <ProfilePage session={session} profileData={profileData} refreshProfile={loadUserData} />;
                else if (view === 'info') content = <InfoPage />;
                else if (view === 'pola') content = <PatternPage luckPercentage={luckPercentage} />;
                else if (view === 'feedback') content = <FeedbackPage session={session} />;
                else if (view === 'shop') content = <ShopPage session={session} balance={balance} updateBalance={updateBalance} profileData={profileData} refreshProfile={loadUserData} />;
                else if (view === 'inbox') content = <InboxPage profileData={profileData} />; 
                else if (view === 'game') {
                    if (!activeGame) content = <Lobby setGame={(g) => { setActiveGame(g); setWinMessage("Siap Main!"); }} onSelectEvent={handleSelectEvent} />;
                    else {
                        const info = GAME_INFO[activeGame];
                        content = (
                            <div className="flex flex-col items-center mt-8 max-w-2xl mx-auto w-full">
                                <button onClick={() => { setActiveGame(null); setWinMessage("Pilih Game"); }} className="mb-6 px-4 py-2 rounded bg-slate-800 hover:bg-slate-700 text-xs text-slate-300 hover:text-white flex items-center gap-2 transition-colors shadow-md border border-white/5"><Icons.ArrowLeft /> KEMBALI KE LOBBY</button>
                                
                                <div className="w-full bg-slate-800/80 p-4 rounded-xl border border-blue-500/30 mb-6 text-left">
                                    <h4 className="text-blue-400 font-bold font-cyber mb-2 flex items-center gap-2"><Icons.Info className="w-4 h-4"/> {info.title}</h4>
                                    <p className="text-xs text-slate-300 mb-2 leading-relaxed">{info.desc}</p>
                                    <div className="flex flex-col sm:flex-row gap-2 text-[10px] mt-2 pt-2 border-t border-white/10">
                                        <span className="bg-green-900/30 text-green-400 px-2 py-1 rounded border border-green-900/50">ðŸŽ¯ Win: {info.win}</span>
                                        <span className="bg-yellow-900/30 text-yellow-400 px-2 py-1 rounded border border-yellow-900/50">ðŸ€ Luck Effect: {info.luck}</span>
                                    </div>
                                </div>

                                {activeGame === 'slot' && <GameSlots balance={balance} updateBalance={updateBalance} setWinMessage={setWinMessage} />}
                                {activeGame === 'wheel' && <GameWheel balance={balance} updateBalance={updateBalance} setWinMessage={setWinMessage} />}
                                {activeGame === 'highlow' && <GameHighLow balance={balance} updateBalance={updateBalance} setWinMessage={setWinMessage} />}
                                {activeGame === 'dice' && <GameDice balance={balance} updateBalance={updateBalance} setWinMessage={setWinMessage} />}
                                {activeGame === 'rocket' && <GameRocket balance={balance} updateBalance={updateBalance} setWinMessage={setWinMessage} />}
                                {activeGame === 'horse' && <GameHorseRace balance={balance} updateBalance={updateBalance} setWinMessage={setWinMessage} />}
                                {activeGame === 'soccer' && <GameSoccer balance={balance} updateBalance={updateBalance} setWinMessage={setWinMessage} />}
                                <GameAds />
                            </div>
                        );
                    }
                } 
                else if (view === 'search') content = <SearchUserPage session={session} />;
                else { content = <Lobby setGame={(g) => { setActiveGame(g); setView('game'); }} onSelectEvent={handleSelectEvent} />; }
                return content;
            };

            return (
                <div className="min-h-screen flex bg-[#020617]">
                    <aside className="w-64 bg-slate-900 border-r border-white/5 hidden md:flex flex-col">
                        <div className="p-6 border-b border-white/5 flex items-center gap-2 text-yellow-500"><Icons.Crown /> <span className="font-cyber font-bold text-xl">ROYAL</span></div>
                        <div onClick={() => setView('profile')} className="p-4 border-b border-white/5 flex gap-3 items-center cursor-pointer hover:bg-white/5 transition-colors group">
                            <div className={`w-12 h-12 rounded-full bg-slate-800 overflow-hidden relative ${getBorderClass(profileData.avatar_border)}`}>
                                <img src={profileData.avatar_url} className="w-full h-full object-cover"/>
                            </div>
                            <div className="truncate flex-1">
                                <div className="text-sm font-bold group-hover:text-yellow-400 transition-colors truncate">{profileData.full_name}</div>
                                <div className="flex items-center gap-1 mt-1"><span className="text-[10px] bg-yellow-600 text-black px-1.5 rounded font-bold uppercase">{profileData.title}</span></div>
                                <div className="text-[10px] text-slate-500 mt-0.5">Lvl: {Math.floor((profileData.total_spins || 0) / 10)}</div>
                            </div>
                        </div>
                        <nav className="flex-1 p-4 space-y-1">
                            {[{id:'lobby',l:'Lobby Game',i:Icons.Home},{id:'search', l:'Cari Pemain', i:Icons.Search},{id:'shop',l:'Avatar Shop',i:Icons.ShoppingBag},{id:'pola',l:'Pola Gacor',i:Icons.Zap},{id:'info',l:'Info App',i:Icons.Info},{id:'feedback',l:'Feedback',i:Icons.Message}].map(m=>(<button key={m.id} onClick={()=>{setView(m.id==='lobby'?'game':m.id); if(m.id==='lobby')setActiveGame(null)}} className={`w-full flex items-center gap-3 p-3 rounded-lg transition ${view===m.id||(view==='game'&&m.id==='lobby')?'bg-yellow-500 text-black font-bold':'text-slate-400 hover:bg-white/5'}`}><m.i/>{m.l}</button>))}
                            {profileData.role === 'admin' && (<><div className="pt-4 pb-2 text-[10px] font-bold text-slate-500 px-3">ADMIN AREA</div><button onClick={() => setView('inbox')} className={`w-full flex items-center gap-3 p-3 rounded-lg transition border border-yellow-500/30 ${view === 'inbox' ? 'bg-yellow-900/30 text-yellow-400 font-bold' : 'text-yellow-600 hover:bg-yellow-900/10'}`}><Icons.Inbox /> Inbox</button></>)}<div className="my-4 border-t border-white/5"></div><button onClick={() => setView('profile')} className={`w-full flex items-center gap-3 p-3 rounded-lg transition ${view === 'profile' ? 'bg-yellow-500 text-black font-bold' : 'text-slate-400 hover:bg-white/5'}`}><Icons.Settings /> Profile</button></nav><div className="p-4"><button onClick={onLogout} className="w-full flex gap-2 p-2 text-red-400 hover:bg-red-900/20 rounded"><Icons.LogOut/> Keluar</button></div></aside><main className="flex-1 h-screen overflow-y-auto flex flex-col"><header className="h-16 bg-slate-900/80 backdrop-blur border-b border-white/5 flex justify-between items-center px-4 sticky top-0 z-10"><div className="md:hidden font-cyber text-yellow-500">ROYAL</div><div className="flex-1"></div><div className="px-4 py-1.5 bg-black/40 rounded-full border border-yellow-500/30 flex gap-2 items-center"><span className="text-[10px] text-slate-400">SALDO</span><span className="font-bold text-yellow-400">{balance.toLocaleString()}</span></div></header><div className="p-4 md:p-8 flex-1">{renderContent()}</div><div className="md:hidden bg-slate-900 border-t border-white/5 flex justify-around p-3"><button onClick={()=>{setView('game');setActiveGame(null)}} className="text-slate-400"><Icons.Home/></button><button onClick={()=>setView('shop')} className="text-slate-400"><Icons.ShoppingBag/></button><button onClick={()=>setView('search')} className="text-slate-400"><Icons.Search/></button><button onClick={()=>setView('profile')} className="text-slate-400"><Icons.Settings/></button></div></main><GlobalChat session={session} profileData={profileData} /></div>);
        }

        function App() {
            const [session, setSession] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            React.useEffect(() => {
                const init = async () => {
                    const local = JSON.parse(localStorage.getItem('sb-session'));
                    if(local) setSession(local);
                    try { const { data } = await supabase.auth.getSession(); if(data.session) setSession(data.session); } catch(e){}
                    setLoading(false);
                };
                init();
                supabase.auth.onAuthStateChange((_e, s) => { setSession(s); if(s) localStorage.setItem('sb-session', JSON.stringify(s)); else localStorage.removeItem('sb-session'); });
            }, []);
            if(loading) return <div className="min-h-screen bg-black flex items-center justify-center text-yellow-500">LOADING...</div>;
            return !session ? <AuthPage /> : <Dashboard session={session} onLogout={() => supabase.auth.signOut()} />;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>